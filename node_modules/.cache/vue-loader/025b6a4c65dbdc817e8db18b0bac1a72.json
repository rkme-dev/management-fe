{"remainingRequest":"/Users/mark/projects/enco-fe/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/mark/projects/enco-fe/src/views/pages/user-access-management/users/UserAbilitiesForm.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/mark/projects/enco-fe/src/views/pages/user-access-management/users/UserAbilitiesForm.vue","mtime":1662204120478},{"path":"/Users/mark/projects/enco-fe/node_modules/cache-loader/dist/cjs.js","mtime":1650363912993},{"path":"/Users/mark/projects/enco-fe/node_modules/babel-loader/lib/index.js","mtime":1652172763063},{"path":"/Users/mark/projects/enco-fe/node_modules/cache-loader/dist/cjs.js","mtime":1650363912993},{"path":"/Users/mark/projects/enco-fe/node_modules/vue-loader/lib/index.js","mtime":1650363919730}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IG1kaUFsZXJ0T3V0bGluZSwgbWRpQ2xvdWRVcGxvYWRPdXRsaW5lLCBtZGlIdW1hbkVkaXQgfSBmcm9tICdAbWRpL2pzJwppbXBvcnQgewogIHRvUmVmLAogIG9uTW91bnRlZCwKICByZWYsCiAgd2F0Y2gsCn0gZnJvbSAnQHZ1ZS9jb21wb3NpdGlvbi1hcGknCmltcG9ydCByb3V0ZXIgZnJvbSAnQC9yb3V0ZXInCmltcG9ydCBzdG9yZSBmcm9tICdAL3N0b3JlJwppbXBvcnQgVXNlckFjY2Vzc01hbmFnZW1lbnRTZXJ2aWNlIGZyb20gJ0Avc2VydmljZS9Vc2VyQWNjZXNzTWFuYWdlbWVudFNlcnZpY2UnCgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ1VzZXJBYmlsaXRpZXNGb3JtVnVlJywKICBwcm9wczogewogICAgdXNlcjogewogICAgICB0eXBlOiBPYmplY3QsCiAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgfSwKICAgIGxvYWRpbmc6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogdHJ1ZSwKICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICB9LAogIH0sCiAgc2V0dXAocHJvcHMpIHsKICAgIGNvbnN0IHNlcnZpY2UgPSBuZXcgVXNlckFjY2Vzc01hbmFnZW1lbnRTZXJ2aWNlKCkKICAgIGNvbnN0IHVzZXJEYXRhID0gdG9SZWYocHJvcHMsICd1c2VyJykKICAgIGNvbnN0IGFiaWxpdGllc09wdGlvbnMgPSByZWYoW10pCiAgICBjb25zdCByb2xlT3B0aW9ucyA9IHJlZihbXSkKICAgIGNvbnN0IGFiaWxpdGllc1NlbGVjdGVkID0gcmVmKFtdKQogICAgY29uc3QgbG9hZGluZ0xvY2FsZSA9IHRvUmVmKHByb3BzLCAnbG9hZGluZycpCiAgICBjb25zdCBzaG93QWxlcnQgPSByZWYoZmFsc2UpCiAgICBjb25zdCBsb2FkaW5nQWJpbGl0aWVzID0gcmVmKHRydWUpCiAgICBjb25zdCByb2xlQWJpbGl0eUlkcyA9IHJlZihbXSkKICAgIGNvbnN0IGFycmF5Q29sdW1uID0gKGFycmF5LCBjb2x1bW4pID0+IHsKICAgICAgaWYgKGFycmF5ID09PSB1bmRlZmluZWQgfHwgYXJyYXkgPT09IG51bGwpIHsKICAgICAgICByZXR1cm4gW10KICAgICAgfQoKICAgICAgcmV0dXJuIGFycmF5Lm1hcChpdGVtID0+IGl0ZW1bY29sdW1uXSkKICAgIH0KCiAgICBvbk1vdW50ZWQoYXN5bmMgKCkgPT4gewogICAgICBpZiAodXNlckRhdGEudmFsdWUuZGVwYXJ0bWVudF9pZCA9PT0gbnVsbCkgewogICAgICAgIGF3YWl0IHNlcnZpY2UuZ2V0QWJpbGl0aWVzKHRydWUpCiAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAgIGFiaWxpdGllc09wdGlvbnMudmFsdWUgPSByZXNwb25zZS5kYXRhCiAgICAgICAgICAgIGFiaWxpdGllc1NlbGVjdGVkLnZhbHVlID0gdXNlckRhdGEudmFsdWUuYWJpbGl0aWVzLm1hcChhYmlsaXR5ID0+IGFiaWxpdHkuaWQpCiAgICAgICAgICAgIGxvYWRpbmdBYmlsaXRpZXMudmFsdWUgPSBmYWxzZQogICAgICAgICAgfSkKCiAgICAgICAgYXdhaXQgc2VydmljZS5nZXRSb2xlcygpCiAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAgIHJvbGVPcHRpb25zLnZhbHVlID0gcmVzcG9uc2UuZGF0YQogICAgICAgICAgfSkKICAgICAgfSBlbHNlIHsKICAgICAgICBhd2FpdCBzZXJ2aWNlLmdldERlcGFydG1lbnRBYmlsaXRpZXModXNlckRhdGEudmFsdWUuZGVwYXJ0bWVudF9pZCkKICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgYWJpbGl0aWVzT3B0aW9ucy52YWx1ZSA9IHJlc3BvbnNlLmRhdGEKICAgICAgICAgICAgYWJpbGl0aWVzU2VsZWN0ZWQudmFsdWUgPSB1c2VyRGF0YS52YWx1ZS5hYmlsaXRpZXMubWFwKGFiaWxpdHkgPT4gYWJpbGl0eS5pZCkKICAgICAgICAgICAgbG9hZGluZ0FiaWxpdGllcy52YWx1ZSA9IGZhbHNlCiAgICAgICAgICB9KQoKICAgICAgICBhd2FpdCBzZXJ2aWNlLmdldERlcGFydG1lbnRSb2xlcyh1c2VyRGF0YS52YWx1ZS5kZXBhcnRtZW50X2lkKQogICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgICByb2xlT3B0aW9ucy52YWx1ZSA9IHJlc3BvbnNlLmRhdGEKICAgICAgICAgIH0pCiAgICAgIH0KCiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11c2UtYmVmb3JlLWRlZmluZQogICAgICBjaGVja0FiaWxpdGllcyh1c2VyRGF0YS52YWx1ZSkKICAgIH0pCgogICAgY29uc3QgY2hlY2tBYmlsaXRpZXMgPSB2YWx1ZSA9PiB7CiAgICAgIGFiaWxpdGllc1NlbGVjdGVkLnZhbHVlID0gdmFsdWUuYWJpbGl0aWVzLm1hcChhYmlsaXR5ID0+IGFiaWxpdHkuaWQpCiAgICAgIGNvbnN0IHJvbGVTZWxlY3RlZCA9IHJvbGVPcHRpb25zLnZhbHVlLmZpbmQocm9sZSA9PiByb2xlLmlkID09PSB2YWx1ZS5yb2xlX2lkKQogICAgICByb2xlQWJpbGl0eUlkcy52YWx1ZSA9IGFycmF5Q29sdW1uKHJvbGVTZWxlY3RlZD8uYWJpbGl0aWVzLCAnaWQnKSA/PyBbXQoKICAgICAgYWJpbGl0aWVzT3B0aW9ucy52YWx1ZS5mb3JFYWNoKChtb2R1bGUsIGluZGV4KSA9PiB7CiAgICAgICAgbGV0IGNvdW50T2ZBYmlsaXR5ID0gMAoKICAgICAgICBtb2R1bGUuYWJpbGl0aWVzLmZvckVhY2goKGFiaWxpdHksIHN1YkluZGV4KSA9PiB7CiAgICAgICAgICBpZiAocm9sZUFiaWxpdHlJZHMudmFsdWUuaW5jbHVkZXMoYWJpbGl0eS5pZCkgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIGlmIChhYmlsaXR5Py5mcm9tUm9sZSAhPT0gdW5kZWZpbmVkICYmIGFiaWxpdHk/LmZyb21Sb2xlID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgY29uc3QgZmluZEluZGV4ID0gYWJpbGl0aWVzU2VsZWN0ZWQudmFsdWUuZmluZEluZGV4KGlkID0+IGlkID09PSBhYmlsaXR5LmlkKQoKICAgICAgICAgICAgICBhYmlsaXRpZXNTZWxlY3RlZC52YWx1ZS5zcGxpY2UoZmluZEluZGV4LCAxKQogICAgICAgICAgICB9CgogICAgICAgICAgICBhYmlsaXRpZXNPcHRpb25zLnZhbHVlW2luZGV4XS5hYmlsaXRpZXNbc3ViSW5kZXhdLmxvY2tlZCA9IGZhbHNlCiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhYmlsaXRpZXNPcHRpb25zLnZhbHVlW2luZGV4XS5hYmlsaXRpZXNbc3ViSW5kZXhdLmZyb21Sb2xlID0gdHJ1ZQogICAgICAgICAgICBhYmlsaXRpZXNPcHRpb25zLnZhbHVlW2luZGV4XS5hYmlsaXRpZXNbc3ViSW5kZXhdLmxvY2tlZCA9IHRydWUKICAgICAgICAgICAgYWJpbGl0aWVzU2VsZWN0ZWQudmFsdWUucHVzaChhYmlsaXR5LmlkKQogICAgICAgICAgICBjb3VudE9mQWJpbGl0eSArPSAxCiAgICAgICAgICB9CiAgICAgICAgfSkKCiAgICAgICAgYWJpbGl0aWVzT3B0aW9ucy52YWx1ZVtpbmRleF0ubG9ja2VkID0gbW9kdWxlLmFiaWxpdGllcy5sZW5ndGggPT09IGNvdW50T2ZBYmlsaXR5CiAgICAgIH0pCiAgICB9CgogICAgd2F0Y2godXNlckRhdGEudmFsdWUsIHZhbHVlID0+IHsKICAgICAgY2hlY2tBYmlsaXRpZXModmFsdWUpCiAgICB9KQoKICAgIC8vIHdhdGNoKGFiaWxpdGllc1NlbGVjdGVkLCB2YWx1ZSA9PiB7CiAgICAvLyAgIGNvbnNvbGUubG9nKHZhbHVlKQogICAgLy8gfSwgdHJ1ZSkKCiAgICBjb25zdCBnb0JhY2sgPSAoKSA9PiB7CiAgICAgIHJvdXRlci5wdXNoKCcvdXNlcnMnKQogICAgfQoKICAgIGNvbnN0IHN1Ym1pdCA9ICgpID0+IHsKICAgICAgc3RvcmUuZGlzcGF0Y2goJ1VzZXJBY2Nlc3NNYW5hZ2VtZW50U3RvcmUvdXBkYXRlVXNlcicsIHsKICAgICAgICByb2xlX2lkOiB1c2VyRGF0YS52YWx1ZS5yb2xlX2lkLAogICAgICAgIGFiaWxpdGllczogYWJpbGl0aWVzU2VsZWN0ZWQudmFsdWUsCiAgICAgICAgaWQ6IHVzZXJEYXRhLnZhbHVlLmlkLAogICAgICB9KS50aGVuKAogICAgICAgIHJlc3BvbnNlID0+IHsKICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBhYmlsaXRpZXNTZWxlY3RlZC52YWx1ZSA9IHJlc3BvbnNlLmRhdGEuYWJpbGl0aWVzLm1hcChhYmlsaXR5ID0+IGFiaWxpdHkuaWQpCiAgICAgICAgICAgIHNob3dBbGVydC52YWx1ZSA9IHRydWUKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgc2hvd0FsZXJ0LnZhbHVlID0gZmFsc2UKICAgICAgICAgICAgfSwgMTUwMCkKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICApCiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgYWJpbGl0aWVzT3B0aW9ucywKICAgICAgYWJpbGl0aWVzU2VsZWN0ZWQsCiAgICAgIGxvYWRpbmdBYmlsaXRpZXMsCiAgICAgIGxvYWRpbmdMb2NhbGUsCiAgICAgIGljb25zOiB7CiAgICAgICAgbWRpQWxlcnRPdXRsaW5lLAogICAgICAgIG1kaUNsb3VkVXBsb2FkT3V0bGluZSwKICAgICAgICBtZGlIdW1hbkVkaXQsCiAgICAgIH0sCiAgICAgIGdvQmFjaywKICAgICAgcm9sZU9wdGlvbnMsCiAgICAgIHNob3dBbGVydCwKICAgICAgc3VibWl0LAogICAgICB1c2VyRGF0YSwKICAgIH0KICB9LAp9Cg=="},{"version":3,"sources":["UserAbilitiesForm.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"UserAbilitiesForm.vue","sourceRoot":"src/views/pages/user-access-management/users","sourcesContent":["<template>\n  <v-card\n    flat\n    class=\"pa-3 mt-2\"\n  >\n    <v-alert\n      v-show=\"showAlert\"\n      dense\n      text\n      type=\"success\"\n      dismissible\n    >\n      Successfully updated\n    </v-alert>\n    <v-card-text>\n      <v-progress-linear\n        v-if=\"loadingLocale || loadingAbilities\"\n        indeterminate\n        color=\"primary\"\n      ></v-progress-linear>\n      <v-form\n        v-if=\"!loadingLocale && !loadingAbilities\"\n        class=\"multi-col-validation mt-6\"\n      >\n        <v-row>\n          <v-col\n            cols=\"12\"\n            md=\"6\"\n          >\n            <v-select\n              v-model=\"userData.role_id\"\n              dense\n              outlined\n              :prepend-inner-icon=\"icons.mdiHumanEdit\"\n              item-text=\"title\"\n              item-value=\"id\"\n              label=\"Role\"\n              :items=\"roleOptions\"\n            ></v-select>\n          </v-col>\n\n          <v-col\n            cols=\"12\"\n            md=\"9\"\n          >\n            <v-treeview\n              v-model=\"abilitiesSelected\"\n              selectable\n              hoverable\n              selected-color=\"primary\"\n              item-disabled=\"locked\"\n              item-key=\"id\"\n              item-text=\"name\"\n              item-children=\"abilities\"\n              :items=\"abilitiesOptions\"\n            ></v-treeview>\n          </v-col>\n\n          <v-col cols=\"12\">\n            <v-btn\n              color=\"primary\"\n              class=\"me-3 mt-4\"\n              @click=\"submit\"\n            >\n              Save changes\n            </v-btn>\n            <v-btn\n              color=\"info\"\n              outlined\n              class=\"mt-3\"\n              type=\"reset\"\n              @click.prevent=\"goBack\"\n            >\n              Back to Users Page\n            </v-btn>\n          </v-col>\n        </v-row>\n      </v-form>\n    </v-card-text>\n  </v-card>\n</template>\n<script>\nimport { mdiAlertOutline, mdiCloudUploadOutline, mdiHumanEdit } from '@mdi/js'\nimport {\n  toRef,\n  onMounted,\n  ref,\n  watch,\n} from '@vue/composition-api'\nimport router from '@/router'\nimport store from '@/store'\nimport UserAccessManagementService from '@/service/UserAccessManagementService'\n\nexport default {\n  name: 'UserAbilitiesFormVue',\n  props: {\n    user: {\n      type: Object,\n      required: true,\n    },\n    loading: {\n      type: Boolean,\n      default: true,\n      required: true,\n    },\n  },\n  setup(props) {\n    const service = new UserAccessManagementService()\n    const userData = toRef(props, 'user')\n    const abilitiesOptions = ref([])\n    const roleOptions = ref([])\n    const abilitiesSelected = ref([])\n    const loadingLocale = toRef(props, 'loading')\n    const showAlert = ref(false)\n    const loadingAbilities = ref(true)\n    const roleAbilityIds = ref([])\n    const arrayColumn = (array, column) => {\n      if (array === undefined || array === null) {\n        return []\n      }\n\n      return array.map(item => item[column])\n    }\n\n    onMounted(async () => {\n      if (userData.value.department_id === null) {\n        await service.getAbilities(true)\n          .then(response => {\n            abilitiesOptions.value = response.data\n            abilitiesSelected.value = userData.value.abilities.map(ability => ability.id)\n            loadingAbilities.value = false\n          })\n\n        await service.getRoles()\n          .then(response => {\n            roleOptions.value = response.data\n          })\n      } else {\n        await service.getDepartmentAbilities(userData.value.department_id)\n          .then(response => {\n            abilitiesOptions.value = response.data\n            abilitiesSelected.value = userData.value.abilities.map(ability => ability.id)\n            loadingAbilities.value = false\n          })\n\n        await service.getDepartmentRoles(userData.value.department_id)\n          .then(response => {\n            roleOptions.value = response.data\n          })\n      }\n\n      // eslint-disable-next-line no-use-before-define\n      checkAbilities(userData.value)\n    })\n\n    const checkAbilities = value => {\n      abilitiesSelected.value = value.abilities.map(ability => ability.id)\n      const roleSelected = roleOptions.value.find(role => role.id === value.role_id)\n      roleAbilityIds.value = arrayColumn(roleSelected?.abilities, 'id') ?? []\n\n      abilitiesOptions.value.forEach((module, index) => {\n        let countOfAbility = 0\n\n        module.abilities.forEach((ability, subIndex) => {\n          if (roleAbilityIds.value.includes(ability.id) === false) {\n            if (ability?.fromRole !== undefined && ability?.fromRole === true) {\n              const findIndex = abilitiesSelected.value.findIndex(id => id === ability.id)\n\n              abilitiesSelected.value.splice(findIndex, 1)\n            }\n\n            abilitiesOptions.value[index].abilities[subIndex].locked = false\n          } else {\n            abilitiesOptions.value[index].abilities[subIndex].fromRole = true\n            abilitiesOptions.value[index].abilities[subIndex].locked = true\n            abilitiesSelected.value.push(ability.id)\n            countOfAbility += 1\n          }\n        })\n\n        abilitiesOptions.value[index].locked = module.abilities.length === countOfAbility\n      })\n    }\n\n    watch(userData.value, value => {\n      checkAbilities(value)\n    })\n\n    // watch(abilitiesSelected, value => {\n    //   console.log(value)\n    // }, true)\n\n    const goBack = () => {\n      router.push('/users')\n    }\n\n    const submit = () => {\n      store.dispatch('UserAccessManagementStore/updateUser', {\n        role_id: userData.value.role_id,\n        abilities: abilitiesSelected.value,\n        id: userData.value.id,\n      }).then(\n        response => {\n          if (response.status === undefined) {\n            abilitiesSelected.value = response.data.abilities.map(ability => ability.id)\n            showAlert.value = true\n            setTimeout(() => {\n              showAlert.value = false\n            }, 1500)\n          }\n        },\n      )\n    }\n\n    return {\n      abilitiesOptions,\n      abilitiesSelected,\n      loadingAbilities,\n      loadingLocale,\n      icons: {\n        mdiAlertOutline,\n        mdiCloudUploadOutline,\n        mdiHumanEdit,\n      },\n      goBack,\n      roleOptions,\n      showAlert,\n      submit,\n      userData,\n    }\n  },\n}\n</script>\n\n<style scoped>\n\n</style>\n"]}]}