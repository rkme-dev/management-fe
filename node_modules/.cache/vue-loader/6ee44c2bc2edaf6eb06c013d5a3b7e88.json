{"remainingRequest":"/Users/mark/projects/enco-fe/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/mark/projects/enco-fe/src/views/pages/user-access-management/users/UserAbilitiesForm.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/mark/projects/enco-fe/src/views/pages/user-access-management/users/UserAbilitiesForm.vue","mtime":1661256506862},{"path":"/Users/mark/projects/enco-fe/node_modules/cache-loader/dist/cjs.js","mtime":1650363912993},{"path":"/Users/mark/projects/enco-fe/node_modules/babel-loader/lib/index.js","mtime":1652172763063},{"path":"/Users/mark/projects/enco-fe/node_modules/cache-loader/dist/cjs.js","mtime":1650363912993},{"path":"/Users/mark/projects/enco-fe/node_modules/vue-loader/lib/index.js","mtime":1650363919730}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IG1kaUFsZXJ0T3V0bGluZSwgbWRpQ2xvdWRVcGxvYWRPdXRsaW5lLCBtZGlIdW1hbkVkaXQgfSBmcm9tICdAbWRpL2pzJwppbXBvcnQgewogIHRvUmVmLAogIG9uTW91bnRlZCwKICByZWYsCiAgd2F0Y2gKfSBmcm9tICdAdnVlL2NvbXBvc2l0aW9uLWFwaScKaW1wb3J0IHJvdXRlciBmcm9tICdAL3JvdXRlcicKaW1wb3J0IHN0b3JlIGZyb20gJ0Avc3RvcmUnCmltcG9ydCBVc2VyQWNjZXNzTWFuYWdlbWVudFNlcnZpY2UgZnJvbSAnQC9zZXJ2aWNlL1VzZXJBY2Nlc3NNYW5hZ2VtZW50U2VydmljZScKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnVXNlckFiaWxpdGllc0Zvcm1WdWUnLAogIHByb3BzOiB7CiAgICB1c2VyOiB7CiAgICAgIHR5cGU6IE9iamVjdCwKICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICB9LAogICAgbG9hZGluZzogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiB0cnVlLAogICAgICByZXF1aXJlZDogdHJ1ZSwKICAgIH0sCiAgfSwKICBzZXR1cChwcm9wcykgewogICAgY29uc3Qgc2VydmljZSA9IG5ldyBVc2VyQWNjZXNzTWFuYWdlbWVudFNlcnZpY2UoKQogICAgY29uc3QgdXNlckRhdGEgPSB0b1JlZihwcm9wcywgJ3VzZXInKQogICAgY29uc3QgYWJpbGl0aWVzT3B0aW9ucyA9IHJlZihbXSkKICAgIGNvbnN0IHJvbGVPcHRpb25zID0gcmVmKFtdKQogICAgY29uc3QgYWJpbGl0aWVzU2VsZWN0ZWQgPSByZWYoW10pCiAgICBjb25zdCBsb2FkaW5nTG9jYWxlID0gdG9SZWYocHJvcHMsICdsb2FkaW5nJykKICAgIGNvbnN0IHNob3dBbGVydCA9IHJlZihmYWxzZSkKICAgIGNvbnN0IGxvYWRpbmdBYmlsaXRpZXMgPSByZWYodHJ1ZSkKCiAgICB3YXRjaCh1c2VyRGF0YSwgdmFsdWUgPT4gewogICAgICBhYmlsaXRpZXNTZWxlY3RlZC52YWx1ZSA9IHZhbHVlLmFiaWxpdGllcy5tYXAoYWJpbGl0eSA9PiBhYmlsaXR5LmlkKQogICAgfSkKCiAgICBvbk1vdW50ZWQoYXN5bmMgKCkgPT4gewogICAgICBpZiAodXNlckRhdGEudmFsdWUuZGVwYXJ0bWVudF9pZCA9PT0gbnVsbCkgewogICAgICAgIGF3YWl0IHNlcnZpY2UuZ2V0QWJpbGl0aWVzKHRydWUpCiAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAgIGFiaWxpdGllc09wdGlvbnMudmFsdWUgPSByZXNwb25zZS5kYXRhCiAgICAgICAgICAgIGFiaWxpdGllc1NlbGVjdGVkLnZhbHVlID0gdXNlckRhdGEudmFsdWUuYWJpbGl0aWVzLm1hcChhYmlsaXR5ID0+IGFiaWxpdHkuaWQpCiAgICAgICAgICAgIGxvYWRpbmdBYmlsaXRpZXMudmFsdWUgPSBmYWxzZQogICAgICAgICAgfSkKCiAgICAgICAgYXdhaXQgc2VydmljZS5nZXRSb2xlcygpCiAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAgIHJvbGVPcHRpb25zLnZhbHVlID0gcmVzcG9uc2UuZGF0YQogICAgICAgICAgfSkKICAgICAgfSBlbHNlIHsKICAgICAgICBhd2FpdCBzZXJ2aWNlLmdldERlcGFydG1lbnRBYmlsaXRpZXModXNlckRhdGEudmFsdWUuZGVwYXJ0bWVudF9pZCkKICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgYWJpbGl0aWVzT3B0aW9ucy52YWx1ZSA9IHJlc3BvbnNlLmRhdGEKICAgICAgICAgICAgYWJpbGl0aWVzU2VsZWN0ZWQudmFsdWUgPSB1c2VyRGF0YS52YWx1ZS5hYmlsaXRpZXMubWFwKGFiaWxpdHkgPT4gYWJpbGl0eS5pZCkKICAgICAgICAgICAgbG9hZGluZ0FiaWxpdGllcy52YWx1ZSA9IGZhbHNlCiAgICAgICAgICB9KQoKICAgICAgICBhd2FpdCBzZXJ2aWNlLmdldERlcGFydG1lbnRSb2xlcyh1c2VyRGF0YS52YWx1ZS5kZXBhcnRtZW50X2lkKQogICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgICByb2xlT3B0aW9ucy52YWx1ZSA9IHJlc3BvbnNlLmRhdGEKICAgICAgICAgIH0pCiAgICAgIH0KICAgIH0pCgogICAgY29uc3QgZ29CYWNrID0gKCkgPT4gewogICAgICByb3V0ZXIucHVzaCgnL3VzZXJzJykKICAgIH0KCiAgICBjb25zdCBzdWJtaXQgPSAoKSA9PiB7CiAgICAgIHN0b3JlLmRpc3BhdGNoKCdVc2VyQWNjZXNzTWFuYWdlbWVudFN0b3JlL3VwZGF0ZVVzZXInLCB7CiAgICAgICAgcm9sZV9pZDogdXNlckRhdGEudmFsdWUucm9sZV9pZCwKICAgICAgICBhYmlsaXRpZXM6IGFiaWxpdGllc1NlbGVjdGVkLnZhbHVlLAogICAgICAgIGlkOiB1c2VyRGF0YS52YWx1ZS5pZCwKICAgICAgfSkudGhlbigKICAgICAgICByZXNwb25zZSA9PiB7CiAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgc2hvd0FsZXJ0LnZhbHVlID0gdHJ1ZQogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICBzaG93QWxlcnQudmFsdWUgPSBmYWxzZQogICAgICAgICAgICB9LCAxNTAwKQogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICkKICAgIH0KCiAgICByZXR1cm4gewogICAgICBhYmlsaXRpZXNPcHRpb25zLAogICAgICBhYmlsaXRpZXNTZWxlY3RlZCwKICAgICAgbG9hZGluZ0FiaWxpdGllcywKICAgICAgbG9hZGluZ0xvY2FsZSwKICAgICAgaWNvbnM6IHsKICAgICAgICBtZGlBbGVydE91dGxpbmUsCiAgICAgICAgbWRpQ2xvdWRVcGxvYWRPdXRsaW5lLAogICAgICAgIG1kaUh1bWFuRWRpdCwKICAgICAgfSwKICAgICAgZ29CYWNrLAogICAgICByb2xlT3B0aW9ucywKICAgICAgc2hvd0FsZXJ0LAogICAgICBzdWJtaXQsCiAgICAgIHVzZXJEYXRhLAogICAgfQogIH0sCn0K"},{"version":3,"sources":["UserAbilitiesForm.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"UserAbilitiesForm.vue","sourceRoot":"src/views/pages/user-access-management/users","sourcesContent":["<template>\n  <v-card\n    flat\n    class=\"pa-3 mt-2\"\n  >\n    <v-alert\n      v-show=\"showAlert\"\n      dense\n      text\n      type=\"success\"\n      dismissible\n    >\n      Successfully updated\n    </v-alert>\n    <v-card-text>\n      <v-progress-linear\n        v-if=\"loadingLocale || loadingAbilities\"\n        indeterminate\n        color=\"primary\"\n      ></v-progress-linear>\n      <v-form\n        v-if=\"!loadingLocale && !loadingAbilities\"\n        class=\"multi-col-validation mt-6\"\n      >\n        <v-row>\n          <v-col\n            cols=\"12\"\n            md=\"6\"\n          >\n            <v-select\n              v-model=\"userData.role_id\"\n              dense\n              outlined\n              :prepend-inner-icon=\"icons.mdiHumanEdit\"\n              item-text=\"title\"\n              item-value=\"id\"\n              label=\"Role\"\n              :items=\"roleOptions\"\n            ></v-select>\n          </v-col>\n\n          <v-col\n            cols=\"12\"\n            md=\"9\"\n          >\n            <v-treeview\n              v-model=\"abilitiesSelected\"\n              selectable\n              selected-color=\"primary\"\n              item-disabled=\"locked\"\n              item-key=\"id\"\n              item-text=\"name\"\n              item-children=\"abilities\"\n              :items=\"abilitiesOptions\"\n            ></v-treeview>\n          </v-col>\n\n          <v-col cols=\"12\">\n            <v-btn\n              color=\"primary\"\n              class=\"me-3 mt-4\"\n              @click=\"submit\"\n            >\n              Save changes\n            </v-btn>\n            <v-btn\n              color=\"info\"\n              outlined\n              class=\"mt-3\"\n              type=\"reset\"\n              @click.prevent=\"goBack\"\n            >\n              Back to Users Page\n            </v-btn>\n          </v-col>\n        </v-row>\n      </v-form>\n    </v-card-text>\n  </v-card>\n</template>\n<script>\nimport { mdiAlertOutline, mdiCloudUploadOutline, mdiHumanEdit } from '@mdi/js'\nimport {\n  toRef,\n  onMounted,\n  ref,\n  watch\n} from '@vue/composition-api'\nimport router from '@/router'\nimport store from '@/store'\nimport UserAccessManagementService from '@/service/UserAccessManagementService'\n\nexport default {\n  name: 'UserAbilitiesFormVue',\n  props: {\n    user: {\n      type: Object,\n      required: true,\n    },\n    loading: {\n      type: Boolean,\n      default: true,\n      required: true,\n    },\n  },\n  setup(props) {\n    const service = new UserAccessManagementService()\n    const userData = toRef(props, 'user')\n    const abilitiesOptions = ref([])\n    const roleOptions = ref([])\n    const abilitiesSelected = ref([])\n    const loadingLocale = toRef(props, 'loading')\n    const showAlert = ref(false)\n    const loadingAbilities = ref(true)\n\n    watch(userData, value => {\n      abilitiesSelected.value = value.abilities.map(ability => ability.id)\n    })\n\n    onMounted(async () => {\n      if (userData.value.department_id === null) {\n        await service.getAbilities(true)\n          .then(response => {\n            abilitiesOptions.value = response.data\n            abilitiesSelected.value = userData.value.abilities.map(ability => ability.id)\n            loadingAbilities.value = false\n          })\n\n        await service.getRoles()\n          .then(response => {\n            roleOptions.value = response.data\n          })\n      } else {\n        await service.getDepartmentAbilities(userData.value.department_id)\n          .then(response => {\n            abilitiesOptions.value = response.data\n            abilitiesSelected.value = userData.value.abilities.map(ability => ability.id)\n            loadingAbilities.value = false\n          })\n\n        await service.getDepartmentRoles(userData.value.department_id)\n          .then(response => {\n            roleOptions.value = response.data\n          })\n      }\n    })\n\n    const goBack = () => {\n      router.push('/users')\n    }\n\n    const submit = () => {\n      store.dispatch('UserAccessManagementStore/updateUser', {\n        role_id: userData.value.role_id,\n        abilities: abilitiesSelected.value,\n        id: userData.value.id,\n      }).then(\n        response => {\n          if (response.status === undefined) {\n            showAlert.value = true\n            setTimeout(() => {\n              showAlert.value = false\n            }, 1500)\n          }\n        },\n      )\n    }\n\n    return {\n      abilitiesOptions,\n      abilitiesSelected,\n      loadingAbilities,\n      loadingLocale,\n      icons: {\n        mdiAlertOutline,\n        mdiCloudUploadOutline,\n        mdiHumanEdit,\n      },\n      goBack,\n      roleOptions,\n      showAlert,\n      submit,\n      userData,\n    }\n  },\n}\n</script>\n\n<style scoped>\n\n</style>\n"]}]}