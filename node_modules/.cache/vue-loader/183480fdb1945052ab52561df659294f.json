{"remainingRequest":"/Users/mark/projects/enco-fe/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/mark/projects/enco-fe/src/views/pages/sales/drs/SalesOrderItems.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/mark/projects/enco-fe/src/views/pages/sales/drs/SalesOrderItems.vue","mtime":1665989216762},{"path":"/Users/mark/projects/enco-fe/node_modules/cache-loader/dist/cjs.js","mtime":1665368576185},{"path":"/Users/mark/projects/enco-fe/node_modules/babel-loader/lib/index.js","mtime":1665368576151},{"path":"/Users/mark/projects/enco-fe/node_modules/cache-loader/dist/cjs.js","mtime":1665368576185},{"path":"/Users/mark/projects/enco-fe/node_modules/vue-loader/lib/index.js","mtime":1665368593779}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7CiAgbWRpQWNjb3VudEVkaXQsCiAgbWRpRGVsZXRlQ2lyY2xlLAogIG1kaUluZm9ybWF0aW9uLAogIG1kaVRleHRCb3hQbHVzLAp9IGZyb20gJ0BtZGkvanMnCmltcG9ydCB7CiAgY29tcHV0ZWQsIHJlZiwgdG9SZWYsIHdhdGNoLAp9IGZyb20gJ0B2dWUvY29tcG9zaXRpb24tYXBpJwppbXBvcnQgc3RvcmUgZnJvbSAnQC9zdG9yZScKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnU2FsZU9yZGVySXRlbXMnLAogIHByb3BzOiB7CiAgICBkaXNhYmxlZDogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgIGRlZmF1bHQ6IGZhbHNlLAogICAgfSwKICAgIG1vZGU6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgIGRlZmF1bHQ6ICgoKSA9PiAnQ3JlYXRlJyksCiAgICB9LAogICAgY3VzdG9tZXJJZDogewogICAgICB0eXBlOiBOdW1iZXIsCiAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgZGVmYXVsdDogbnVsbCwKICAgIH0sCiAgICBpdGVtczogewogICAgICB0eXBlOiBBcnJheSwKICAgICAgcmVxdWlyZWQ6IGZhbHNlLAogICAgICBkZWZhdWx0OiBudWxsLAogICAgfSwKICB9LAogIHNldHVwKHByb3BzLCB7IGVtaXQgfSkgewogICAgc3RvcmUuZGlzcGF0Y2goJ1Byb2R1Y3RTdG9yZS9saXN0JykKICAgIGNvbnN0IHNlYXJjaCA9IHJlZigpCiAgICBjb25zdCBtb2RlRGF0YSA9IHRvUmVmKHByb3BzLCAnbW9kZScpCiAgICBjb25zdCBjdXN0b21lcklkRGF0YSA9IHRvUmVmKHByb3BzLCAnY3VzdG9tZXJJZCcpCiAgICBjb25zdCBmb3JtRGF0YSA9IHJlZih7fSkKICAgIGNvbnN0IGZvcm1UaXRsZSA9IHJlZignQWRkIEl0ZW0nKQogICAgY29uc3QgZXhpc3RpbmdTYWxlc09yZGVySXRlbXMgPSB0b1JlZihwcm9wcywgJ2l0ZW1zJykKICAgIGNvbnN0IG9yZGVySXRlbXMgPSBjb21wdXRlZCgoKSA9PiB7CiAgICAgIGlmIChtb2RlRGF0YS52YWx1ZSA9PT0gJ0NyZWF0ZScpIHsKICAgICAgICByZXR1cm4gc3RvcmUuc3RhdGUuU2FsZXNPcmRlclN0b3JlLml0ZW1zPy5maWx0ZXIoaXRlbSA9PiBpdGVtLmhhc19kciA9PT0gMCkKICAgICAgfQoKICAgICAgcmV0dXJuIHN0b3JlLnN0YXRlLlNhbGVzT3JkZXJTdG9yZS5pdGVtcwogICAgfSkKICAgIGNvbnN0IHByb2R1Y3RzID0gY29tcHV0ZWQoKCkgPT4gc3RvcmUuc3RhdGUuUHJvZHVjdFN0b3JlLmxpc3QpCiAgICBjb25zdCBzZWxlY3RlZE9yZGVySXRlbXMgPSByZWYoW10pCiAgICBjb25zdCBjdXJyZW50SXRlbSA9IHJlZih7CiAgICAgIHByb2R1Y3RfaWQ6IG51bGwsCiAgICAgIHF1YW50aXR5OiBudWxsLAogICAgICBwcmljZTogbnVsbCwKICAgICAgdG90YWxfYW1vdW50OiAwLAogICAgICB1bml0OiBudWxsLAogICAgICBuYW1lOiBudWxsLAogICAgICBza3U6IG51bGwsCiAgICAgIHNsdWc6IG51bGwsCiAgICB9KQoKICAgIGNvbnN0IHNhbGVzT3JkZXJUb3RhbEFtb3VudCA9IHJlZigwKQogICAgY29uc3Qgb3JkZXJJdGVtSWRzID0gcmVmKFtdKQoKICAgIHN0b3JlLmRpc3BhdGNoKCdTYWxlc09yZGVyU3RvcmUvcmVzZXRPcmRlckl0ZW1zJykKCiAgICB3YXRjaChjdXN0b21lcklkRGF0YSwgKCkgPT4gewogICAgICBzYWxlc09yZGVyVG90YWxBbW91bnQudmFsdWUgPSAwCiAgICAgIHNlbGVjdGVkT3JkZXJJdGVtcy52YWx1ZSA9IFtdCgogICAgICBpZiAoY3VzdG9tZXJJZERhdGEudmFsdWUgPT09IG51bGwpIHsKICAgICAgICBzdG9yZS5kaXNwYXRjaCgnU2FsZXNPcmRlclN0b3JlL3Jlc2V0T3JkZXJJdGVtcycpCiAgICAgIH0KICAgIH0pCgogICAgd2F0Y2gob3JkZXJJdGVtcywgKCkgPT4gewogICAgICBzYWxlc09yZGVyVG90YWxBbW91bnQudmFsdWUgPSAwCgogICAgICBzZWxlY3RlZE9yZGVySXRlbXMudmFsdWUgPSBbXQoKICAgICAgaWYgKGV4aXN0aW5nU2FsZXNPcmRlckl0ZW1zLnZhbHVlKSB7CiAgICAgICAgZXhpc3RpbmdTYWxlc09yZGVySXRlbXMudmFsdWUuZm9yRWFjaChpdGVtID0+IHsKICAgICAgICAgIGNvbnN0IGZpbmRJdGVtID0gb3JkZXJJdGVtcy52YWx1ZS5maW5kKG9yZGVySXRlbSA9PiBvcmRlckl0ZW0ub3JkZXJfaXRlbV9pZCA9PT0gaXRlbS5zYWxlc19vcmRlcl9pdGVtX2lkKQoKICAgICAgICAgIGlmIChmaW5kSXRlbSkgewogICAgICAgICAgICBzZWxlY3RlZE9yZGVySXRlbXMudmFsdWUucHVzaChmaW5kSXRlbSkKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICB9CiAgICB9KQoKICAgIHdhdGNoKHNlbGVjdGVkT3JkZXJJdGVtcywgKCkgPT4gewogICAgICBvcmRlckl0ZW1JZHMudmFsdWUgPSBbXQoKICAgICAgaWYgKHNlbGVjdGVkT3JkZXJJdGVtcy52YWx1ZS5sZW5ndGggPiAwKSB7CiAgICAgICAgc2FsZXNPcmRlclRvdGFsQW1vdW50LnZhbHVlID0gMAoKICAgICAgICBzZWxlY3RlZE9yZGVySXRlbXMudmFsdWUuZm9yRWFjaChvcmRlckl0ZW0gPT4gewogICAgICAgICAgaWYgKG9yZGVySXRlbSkgewogICAgICAgICAgICBvcmRlckl0ZW1JZHMudmFsdWUucHVzaChvcmRlckl0ZW0ub3JkZXJfaXRlbV9pZCkKICAgICAgICAgICAgc2FsZXNPcmRlclRvdGFsQW1vdW50LnZhbHVlID0gcGFyc2VGbG9hdChzYWxlc09yZGVyVG90YWxBbW91bnQudmFsdWUpICsgcGFyc2VGbG9hdChvcmRlckl0ZW0/LnRvdGFsX2Ftb3VudCkKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICB9IGVsc2UgewogICAgICAgIHNhbGVzT3JkZXJUb3RhbEFtb3VudC52YWx1ZSA9IDAKICAgICAgfQoKICAgICAgZW1pdCgndG90YWxBbW91bnQnLCBzYWxlc09yZGVyVG90YWxBbW91bnQudmFsdWUpCiAgICAgIGVtaXQoJ29yZGVySXRlbUlkcycsIG9yZGVySXRlbUlkcy52YWx1ZSkKICAgIH0pCgogICAgcmV0dXJuIHsKICAgICAgc2VhcmNoLAogICAgICBzZWxlY3RlZE9yZGVySXRlbXMsCiAgICAgIHNhbGVzT3JkZXJUb3RhbEFtb3VudCwKICAgICAgZm9ybVRpdGxlLAogICAgICBjdXJyZW50SXRlbSwKICAgICAgb3JkZXJJdGVtcywKICAgICAgZm9ybURhdGEsCiAgICAgIHByb2R1Y3RzLAogICAgICBoZWFkZXJzOiBbCiAgICAgICAgeyB0ZXh0OiAnRGF0ZScsIHNvcnRhYmxlOiB0cnVlLCB2YWx1ZTogJ2RhdGVfcG9zdGVkJyB9LAogICAgICAgIHsgdGV4dDogJ1NPIE5vJywgdmFsdWU6ICdzYWxlc19vcmRlcl9udW1iZXInLCBzb3J0YWJsZTogdHJ1ZSB9LAogICAgICAgIHsgdGV4dDogJ1Byb2R1Y3QgTmFtZScsIHZhbHVlOiAncHJvZHVjdF9uYW1lJywgc29ydGFibGU6IHRydWUgfSwKICAgICAgICB7IHRleHQ6ICdRdWFudGl0eScsIHZhbHVlOiAncXVhbnRpdHknLCBzb3J0YWJsZTogdHJ1ZSB9LAogICAgICAgIHsgdGV4dDogJ1VuaXQnLCB2YWx1ZTogJ3VuaXQnLCBzb3J0YWJsZTogdHJ1ZSB9LAogICAgICAgIHsgdGV4dDogJ1ByaWNlJywgdmFsdWU6ICdwcmljZScsIHNvcnRhYmxlOiB0cnVlIH0sCiAgICAgICAgeyB0ZXh0OiAnQW1vdW50JywgdmFsdWU6ICd0b3RhbF9hbW91bnQnLCBzb3J0YWJsZTogdHJ1ZSB9LAogICAgICBdLAogICAgICBpY29uczogewogICAgICAgIG1kaUFjY291bnRFZGl0LAogICAgICAgIG1kaURlbGV0ZUNpcmNsZSwKICAgICAgICBtZGlJbmZvcm1hdGlvbiwKICAgICAgICBtZGlUZXh0Qm94UGx1cywKICAgICAgfSwKICAgIH0KICB9LAp9Cg=="},{"version":3,"sources":["SalesOrderItems.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"SalesOrderItems.vue","sourceRoot":"src/views/pages/sales/drs","sourcesContent":["<template>\n  <v-row class=\"\">\n    <v-col cols=\"12\">\n      <v-alert\n        color=\"success\"\n        text\n        style=\"margin-bottom: -30px\"\n      >\n        <div class=\"d-flex align-start\">\n          <v-icon color=\"success\">\n            {{ icons.mdiInformation }}\n          </v-icon>\n          <div class=\"ms-3\">\n            <p class=\"text-base font-weight-medium mb-1\">\n              Sales Order Items\n            </p>\n          </div>\n        </div>\n      </v-alert>\n    </v-col>\n    <v-col\n      class=\"\"\n      cols=\"12\"\n    >\n      <v-data-table\n        v-model=\"selectedOrderItems\"\n        :headers=\"headers\"\n        :items=\"orderItems\"\n        :items-per-page=\"5\"\n        :search=\"search\"\n        item-key=\"order_item_id\"\n        show-select\n      >\n        <template v-slot:item.data-table-select=\"{ item, isSelected, select }\">\n          <v-simple-checkbox\n            :value=\"isSelected\"\n            :disabled=\"disabled\"\n            :ripple=\"false\"\n            @input=\"select($event)\"\n          ></v-simple-checkbox>\n        </template>\n        <template v-slot:top>\n          <v-toolbar\n            flat\n          >\n            <v-card-text>\n              <v-row class=\"mt-10\">\n                <v-col\n                  cols=\"4\"\n                >\n                  <v-text-field\n                    v-model=\"search\"\n                    :append-icon=\"icons.mdiMagnify\"\n                    label=\"Search\"\n                    single-line\n                    hide-details\n                  ></v-text-field>\n                </v-col>\n                <v-col\n                  cols=\"4\"\n                >\n                </v-col>\n                <v-col\n                  class=\"\"\n                  cols=\"4\"\n                >\n                  <v-currency-field\n                    v-model=\"salesOrderTotalAmount\"\n                    outlined\n                    class=\"text-green\"\n                    disabled\n                    dense\n                    hide-details=\"auto\"\n                    label=\"Sales Order Total Amount\"\n                  ></v-currency-field>\n                </v-col>\n                <v-col\n                  cols=\"4\"\n                  offset-md=\"4\"\n                >\n                </v-col>\n              </v-row>\n            </v-card-text>\n          </v-toolbar>\n        </template>\n        <template #item.price=\"{ item }\">\n          <v-currency-field\n            v-model=\"item.price\"\n            prefix=\"PHP\"\n            class=\"text-green\"\n            disabled\n          >\n          </v-currency-field>\n        </template>\n        <template #item.total_amount=\"{ item }\">\n          <v-currency-field\n            v-model=\"item.total_amount\"\n            prefix=\"PHP\"\n            class=\"text-green\"\n            disabled\n          >\n          </v-currency-field>\n        </template>\n        <template v-slot:item.actions=\"{ item }\">\n          <v-icon\n            small\n            @click=\"deleteItem(item)\"\n          >\n            {{ icons.mdiDeleteCircle }}\n          </v-icon>\n        </template>\n      </v-data-table>\n    </v-col>\n  </v-row>\n</template>\n\n<script>\nimport {\n  mdiAccountEdit,\n  mdiDeleteCircle,\n  mdiInformation,\n  mdiTextBoxPlus,\n} from '@mdi/js'\nimport {\n  computed, ref, toRef, watch,\n} from '@vue/composition-api'\nimport store from '@/store'\n\nexport default {\n  name: 'SaleOrderItems',\n  props: {\n    disabled: {\n      type: Boolean,\n      required: false,\n      default: false,\n    },\n    mode: {\n      type: String,\n      required: false,\n      default: (() => 'Create'),\n    },\n    customerId: {\n      type: Number,\n      required: false,\n      default: null,\n    },\n    items: {\n      type: Array,\n      required: false,\n      default: null,\n    },\n  },\n  setup(props, { emit }) {\n    store.dispatch('ProductStore/list')\n    const search = ref()\n    const modeData = toRef(props, 'mode')\n    const customerIdData = toRef(props, 'customerId')\n    const formData = ref({})\n    const formTitle = ref('Add Item')\n    const existingSalesOrderItems = toRef(props, 'items')\n    const orderItems = computed(() => {\n      if (modeData.value === 'Create') {\n        return store.state.SalesOrderStore.items?.filter(item => item.has_dr === 0)\n      }\n\n      return store.state.SalesOrderStore.items\n    })\n    const products = computed(() => store.state.ProductStore.list)\n    const selectedOrderItems = ref([])\n    const currentItem = ref({\n      product_id: null,\n      quantity: null,\n      price: null,\n      total_amount: 0,\n      unit: null,\n      name: null,\n      sku: null,\n      slug: null,\n    })\n\n    const salesOrderTotalAmount = ref(0)\n    const orderItemIds = ref([])\n\n    store.dispatch('SalesOrderStore/resetOrderItems')\n\n    watch(customerIdData, () => {\n      salesOrderTotalAmount.value = 0\n      selectedOrderItems.value = []\n\n      if (customerIdData.value === null) {\n        store.dispatch('SalesOrderStore/resetOrderItems')\n      }\n    })\n\n    watch(orderItems, () => {\n      salesOrderTotalAmount.value = 0\n\n      selectedOrderItems.value = []\n\n      if (existingSalesOrderItems.value) {\n        existingSalesOrderItems.value.forEach(item => {\n          const findItem = orderItems.value.find(orderItem => orderItem.order_item_id === item.sales_order_item_id)\n\n          if (findItem) {\n            selectedOrderItems.value.push(findItem)\n          }\n        })\n      }\n    })\n\n    watch(selectedOrderItems, () => {\n      orderItemIds.value = []\n\n      if (selectedOrderItems.value.length > 0) {\n        salesOrderTotalAmount.value = 0\n\n        selectedOrderItems.value.forEach(orderItem => {\n          if (orderItem) {\n            orderItemIds.value.push(orderItem.order_item_id)\n            salesOrderTotalAmount.value = parseFloat(salesOrderTotalAmount.value) + parseFloat(orderItem?.total_amount)\n          }\n        })\n      } else {\n        salesOrderTotalAmount.value = 0\n      }\n\n      emit('totalAmount', salesOrderTotalAmount.value)\n      emit('orderItemIds', orderItemIds.value)\n    })\n\n    return {\n      search,\n      selectedOrderItems,\n      salesOrderTotalAmount,\n      formTitle,\n      currentItem,\n      orderItems,\n      formData,\n      products,\n      headers: [\n        { text: 'Date', sortable: true, value: 'date_posted' },\n        { text: 'SO No', value: 'sales_order_number', sortable: true },\n        { text: 'Product Name', value: 'product_name', sortable: true },\n        { text: 'Quantity', value: 'quantity', sortable: true },\n        { text: 'Unit', value: 'unit', sortable: true },\n        { text: 'Price', value: 'price', sortable: true },\n        { text: 'Amount', value: 'total_amount', sortable: true },\n      ],\n      icons: {\n        mdiAccountEdit,\n        mdiDeleteCircle,\n        mdiInformation,\n        mdiTextBoxPlus,\n      },\n    }\n  },\n}\n</script>\n\n<style>\n.text-green input {\n  color: chartreuse !important;\n}\n</style>\n"]}]}