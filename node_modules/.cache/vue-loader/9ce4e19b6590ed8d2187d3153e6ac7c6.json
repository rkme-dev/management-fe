{"remainingRequest":"/Users/mark/projects/enco-fe/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/mark/projects/enco-fe/src/views/pages/user-access-management/users/UserAbilitiesForm.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/mark/projects/enco-fe/src/views/pages/user-access-management/users/UserAbilitiesForm.vue","mtime":1657522706649},{"path":"/Users/mark/projects/enco-fe/node_modules/babel-loader/lib/index.js","mtime":1652172763063},{"path":"/Users/mark/projects/enco-fe/node_modules/cache-loader/dist/cjs.js","mtime":1650363912993},{"path":"/Users/mark/projects/enco-fe/node_modules/vue-loader/lib/index.js","mtime":1650363919730}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IG1kaUFsZXJ0T3V0bGluZSwgbWRpQ2xvdWRVcGxvYWRPdXRsaW5lLCBtZGlIdW1hbkVkaXQgfSBmcm9tICdAbWRpL2pzJwppbXBvcnQgewogIHRvUmVmLAogIG9uTW91bnRlZCwKICByZWYsCiAgd2F0Y2gKfSBmcm9tICdAdnVlL2NvbXBvc2l0aW9uLWFwaScKaW1wb3J0IHJvdXRlciBmcm9tICdAL3JvdXRlcicKaW1wb3J0IHN0b3JlIGZyb20gJ0Avc3RvcmUnCmltcG9ydCBVc2VyQWNjZXNzTWFuYWdlbWVudFNlcnZpY2UgZnJvbSAnQC9zZXJ2aWNlL1VzZXJBY2Nlc3NNYW5hZ2VtZW50U2VydmljZScKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnVXNlckFiaWxpdGllc0Zvcm1WdWUnLAogIHByb3BzOiB7CiAgICB1c2VyOiB7CiAgICAgIHR5cGU6IE9iamVjdCwKICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICB9LAogICAgbG9hZGluZzogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiB0cnVlLAogICAgICByZXF1aXJlZDogdHJ1ZSwKICAgIH0sCiAgfSwKICBzZXR1cChwcm9wcykgewogICAgY29uc3Qgc2VydmljZSA9IG5ldyBVc2VyQWNjZXNzTWFuYWdlbWVudFNlcnZpY2UoKQogICAgY29uc3QgdXNlckRhdGEgPSB0b1JlZihwcm9wcywgJ3VzZXInKQogICAgY29uc3QgYWJpbGl0aWVzT3B0aW9ucyA9IHJlZihbXSkKICAgIGNvbnN0IHJvbGVPcHRpb25zID0gcmVmKFtdKQogICAgY29uc3QgYWJpbGl0aWVzU2VsZWN0ZWQgPSByZWYoW10pCiAgICBjb25zdCBsb2FkaW5nTG9jYWxlID0gdG9SZWYocHJvcHMsICdsb2FkaW5nJykKICAgIGNvbnN0IHNob3dBbGVydCA9IHJlZihmYWxzZSkKICAgIGNvbnN0IGxvYWRpbmdBYmlsaXRpZXMgPSByZWYodHJ1ZSkKCiAgICB3YXRjaCh1c2VyRGF0YSwgdmFsdWUgPT4gewogICAgICBhYmlsaXRpZXNTZWxlY3RlZC52YWx1ZSA9IHZhbHVlLmFiaWxpdGllcy5tYXAoYWJpbGl0eSA9PiBhYmlsaXR5LmlkKQogICAgfSkKCiAgICBvbk1vdW50ZWQoYXN5bmMgKCkgPT4gewogICAgICBhd2FpdCBzZXJ2aWNlLmdldEFiaWxpdGllcyh0cnVlKQogICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgIGFiaWxpdGllc09wdGlvbnMudmFsdWUgPSByZXNwb25zZS5kYXRhCiAgICAgICAgICBhYmlsaXRpZXNTZWxlY3RlZC52YWx1ZSA9IHVzZXJEYXRhLnZhbHVlLmFiaWxpdGllcy5tYXAoYWJpbGl0eSA9PiBhYmlsaXR5LmlkKQogICAgICAgICAgbG9hZGluZ0FiaWxpdGllcy52YWx1ZSA9IGZhbHNlCiAgICAgICAgfSkKCiAgICAgIGF3YWl0IHNlcnZpY2UuZ2V0Um9sZXModHJ1ZSkKICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICByb2xlT3B0aW9ucy52YWx1ZSA9IHJlc3BvbnNlLmRhdGEKICAgICAgICB9KQogICAgfSkKCiAgICBjb25zdCBnb0JhY2sgPSAoKSA9PiB7CiAgICAgIHJvdXRlci5wdXNoKCcvdXNlcnMnKQogICAgfQoKICAgIGNvbnN0IHN1Ym1pdCA9ICgpID0+IHsKICAgICAgc3RvcmUuZGlzcGF0Y2goJ1VzZXJBY2Nlc3NNYW5hZ2VtZW50U3RvcmUvdXBkYXRlVXNlcicsIHsKICAgICAgICByb2xlX2lkOiB1c2VyRGF0YS52YWx1ZS5yb2xlX2lkLAogICAgICAgIGFiaWxpdGllczogYWJpbGl0aWVzU2VsZWN0ZWQudmFsdWUsCiAgICAgICAgaWQ6IHVzZXJEYXRhLnZhbHVlLmlkLAogICAgICB9KS50aGVuKAogICAgICAgIHJlc3BvbnNlID0+IHsKICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBzaG93QWxlcnQudmFsdWUgPSB0cnVlCiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgIHNob3dBbGVydC52YWx1ZSA9IGZhbHNlCiAgICAgICAgICAgIH0sIDE1MDApCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgKQogICAgfQoKICAgIHJldHVybiB7CiAgICAgIGFiaWxpdGllc09wdGlvbnMsCiAgICAgIGFiaWxpdGllc1NlbGVjdGVkLAogICAgICBsb2FkaW5nQWJpbGl0aWVzLAogICAgICBsb2FkaW5nTG9jYWxlLAogICAgICBpY29uczogewogICAgICAgIG1kaUFsZXJ0T3V0bGluZSwKICAgICAgICBtZGlDbG91ZFVwbG9hZE91dGxpbmUsCiAgICAgICAgbWRpSHVtYW5FZGl0LAogICAgICB9LAogICAgICBnb0JhY2ssCiAgICAgIHJvbGVPcHRpb25zLAogICAgICBzaG93QWxlcnQsCiAgICAgIHN1Ym1pdCwKICAgICAgdXNlckRhdGEsCiAgICB9CiAgfSwKfQo="},{"version":3,"sources":["UserAbilitiesForm.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"UserAbilitiesForm.vue","sourceRoot":"src/views/pages/user-access-management/users","sourcesContent":["<template>\n  <v-card\n    flat\n    class=\"pa-3 mt-2\"\n  >\n    <v-alert\n      v-show=\"showAlert\"\n      dense\n      text\n      type=\"success\"\n      dismissible\n    >\n      Successfully updated\n    </v-alert>\n    <v-card-text>\n      <v-progress-linear\n        v-if=\"loadingLocale || loadingAbilities\"\n        indeterminate\n        color=\"primary\"\n      ></v-progress-linear>\n      <v-form\n        v-if=\"!loadingLocale && !loadingAbilities\"\n        class=\"multi-col-validation mt-6\"\n      >\n        <v-row>\n          <v-col\n            cols=\"12\"\n            md=\"6\"\n          >\n            <v-select\n              v-model=\"userData.role_id\"\n              dense\n              outlined\n              :prepend-inner-icon=\"icons.mdiHumanEdit\"\n              item-text=\"title\"\n              item-value=\"id\"\n              label=\"Role\"\n              :items=\"roleOptions\"\n            ></v-select>\n          </v-col>\n\n          <v-col\n            cols=\"12\"\n            md=\"9\"\n          >\n            <v-treeview\n              v-model=\"abilitiesSelected\"\n              selectable\n              selected-color=\"primary\"\n              item-disabled=\"locked\"\n              item-key=\"id\"\n              item-text=\"name\"\n              item-children=\"abilities\"\n              :items=\"abilitiesOptions\"\n            ></v-treeview>\n          </v-col>\n\n          <v-col cols=\"12\">\n            <v-btn\n              color=\"primary\"\n              class=\"me-3 mt-4\"\n              @click=\"submit\"\n            >\n              Save changes\n            </v-btn>\n            <v-btn\n              color=\"info\"\n              outlined\n              class=\"mt-3\"\n              type=\"reset\"\n              @click.prevent=\"goBack\"\n            >\n              Back to Users Page\n            </v-btn>\n          </v-col>\n        </v-row>\n      </v-form>\n    </v-card-text>\n  </v-card>\n</template>\n<script>\nimport { mdiAlertOutline, mdiCloudUploadOutline, mdiHumanEdit } from '@mdi/js'\nimport {\n  toRef,\n  onMounted,\n  ref,\n  watch\n} from '@vue/composition-api'\nimport router from '@/router'\nimport store from '@/store'\nimport UserAccessManagementService from '@/service/UserAccessManagementService'\n\nexport default {\n  name: 'UserAbilitiesFormVue',\n  props: {\n    user: {\n      type: Object,\n      required: true,\n    },\n    loading: {\n      type: Boolean,\n      default: true,\n      required: true,\n    },\n  },\n  setup(props) {\n    const service = new UserAccessManagementService()\n    const userData = toRef(props, 'user')\n    const abilitiesOptions = ref([])\n    const roleOptions = ref([])\n    const abilitiesSelected = ref([])\n    const loadingLocale = toRef(props, 'loading')\n    const showAlert = ref(false)\n    const loadingAbilities = ref(true)\n\n    watch(userData, value => {\n      abilitiesSelected.value = value.abilities.map(ability => ability.id)\n    })\n\n    onMounted(async () => {\n      await service.getAbilities(true)\n        .then(response => {\n          abilitiesOptions.value = response.data\n          abilitiesSelected.value = userData.value.abilities.map(ability => ability.id)\n          loadingAbilities.value = false\n        })\n\n      await service.getRoles(true)\n        .then(response => {\n          roleOptions.value = response.data\n        })\n    })\n\n    const goBack = () => {\n      router.push('/users')\n    }\n\n    const submit = () => {\n      store.dispatch('UserAccessManagementStore/updateUser', {\n        role_id: userData.value.role_id,\n        abilities: abilitiesSelected.value,\n        id: userData.value.id,\n      }).then(\n        response => {\n          if (response.status === undefined) {\n            showAlert.value = true\n            setTimeout(() => {\n              showAlert.value = false\n            }, 1500)\n          }\n        },\n      )\n    }\n\n    return {\n      abilitiesOptions,\n      abilitiesSelected,\n      loadingAbilities,\n      loadingLocale,\n      icons: {\n        mdiAlertOutline,\n        mdiCloudUploadOutline,\n        mdiHumanEdit,\n      },\n      goBack,\n      roleOptions,\n      showAlert,\n      submit,\n      userData,\n    }\n  },\n}\n</script>\n\n<style scoped>\n\n</style>\n"]}]}