{"remainingRequest":"/Users/mark/projects/enco-fe/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/mark/projects/enco-fe/src/views/pages/sales/collections/DrListSelection.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/mark/projects/enco-fe/src/views/pages/sales/collections/DrListSelection.vue","mtime":1665831487551},{"path":"/Users/mark/projects/enco-fe/node_modules/cache-loader/dist/cjs.js","mtime":1665368576185},{"path":"/Users/mark/projects/enco-fe/node_modules/babel-loader/lib/index.js","mtime":1665368576151},{"path":"/Users/mark/projects/enco-fe/node_modules/cache-loader/dist/cjs.js","mtime":1665368576185},{"path":"/Users/mark/projects/enco-fe/node_modules/vue-loader/lib/index.js","mtime":1665368593779}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7CiAgY29tcHV0ZWQsIHJlZiwgdG9SZWYsIHdhdGNoLAogIG9uTW91bnRlZCwgb25Vbm1vdW50ZWQsCn0gZnJvbSAnQHZ1ZS9jb21wb3NpdGlvbi1hcGknCmltcG9ydCBzdG9yZSBmcm9tICdAL3N0b3JlJwppbXBvcnQgeyBkYXRlRm9ybWF0MSB9IGZyb20gJ0AvdXRpbHMvdGltZScKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnRHJMaXN0U2VsZWN0aW9uJywKICBwcm9wczogewogICAgY3VzdG9tZXJJZDogewogICAgICB0eXBlOiBOdW1iZXIsCiAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICBkZWZhdWx0OiBudWxsLAogICAgfSwKICAgIGV4aXN0aW5nU2VsZWN0ZWREcjogewogICAgICB0eXBlOiBBcnJheSwKICAgICAgcmVxdWlyZWQ6IGZhbHNlLAogICAgICBkZWZhdWx0OiBudWxsLAogICAgfSwKICB9LAogIHNldHVwKHByb3BzLCB7IGVtaXQgfSkgewogICAgY29uc3QgY3VzdG9tZXJJZERhdGEgPSB0b1JlZihwcm9wcywgJ2N1c3RvbWVySWQnKQogICAgY29uc3QgZXhpc3RpbmdTZWxlY3RlZERycyA9IHRvUmVmKHByb3BzLCAnZXhpc3RpbmdTZWxlY3RlZERyJykKICAgIGNvbnN0IHNlbGVjdGVkRHJzID0gcmVmKFtdKQogICAgY29uc3QgbGlzdCA9IGNvbXB1dGVkKCgpID0+IHN0b3JlLnN0YXRlLlNhbGVzRHJTdG9yZS5pdGVtcykKICAgIGNvbnN0IGxvYWRpbmcgPSBjb21wdXRlZCgoKSA9PiBzdG9yZS5zdGF0ZS5TYWxlc0RyU3RvcmUubG9hZGluZykKICAgIGNvbnN0IHNob3dTdWJtaXQgPSByZWYoZmFsc2UpCiAgICBjb25zdCBzZWFyY2ggPSByZWYoKQogICAgY29uc3QgbGlzdFJlY29tcHV0ZSA9IHJlZihbXSkKCiAgICBjb25zdCByZWluaXRpYWxpemVFeGlzdGluZ1NlbGVjdGVkRHJzID0gKCkgPT4gewogICAgICBpZiAoZXhpc3RpbmdTZWxlY3RlZERycy52YWx1ZS5sZW5ndGggPT09IDApIHsKICAgICAgICBzZWxlY3RlZERycy52YWx1ZSA9IFtdCiAgICAgICAgc3RvcmUuZGlzcGF0Y2goJ1NhbGVzRHJTdG9yZS9kckxpc3RCeUN1c3RvbWVyJywgY3VzdG9tZXJJZERhdGEudmFsdWUpCgogICAgICAgIHJldHVybgogICAgICB9CgogICAgICBsaXN0UmVjb21wdXRlLnZhbHVlID0gW10KICAgICAgc2VsZWN0ZWREcnMudmFsdWUgPSBbXQoKICAgICAgZXhpc3RpbmdTZWxlY3RlZERycy52YWx1ZS5mb3JFYWNoKGl0ZW0gPT4gewogICAgICAgIGxpc3QudmFsdWUuZm9yRWFjaChsaXN0SXRlbSA9PiB7CiAgICAgICAgICBjb25zdCBpZCA9IGl0ZW0uc2FsZXNfZHI/LmlkID8/IGl0ZW0uaWQKCiAgICAgICAgICBjb25zdCBleGlzdCA9IChsaXN0SXRlbS5pZCA9PT0gaWQpID8gbGlzdEl0ZW0gOiBmYWxzZQoKICAgICAgICAgIGlmIChleGlzdCkgewogICAgICAgICAgICBsaXN0UmVjb21wdXRlLnZhbHVlLnB1c2goZXhpc3QpCiAgICAgICAgICAgIHNlbGVjdGVkRHJzLnZhbHVlLnB1c2goZXhpc3QpCiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsaXN0UmVjb21wdXRlLnZhbHVlLnB1c2gobGlzdEl0ZW0pCiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgfSkKCiAgICAgIHN0b3JlLmRpc3BhdGNoKCdTYWxlc0RyU3RvcmUvdXBkYXRlT3JkZXJJdGVtcycsIGxpc3RSZWNvbXB1dGUudmFsdWUpCiAgICB9CgogICAgb25Nb3VudGVkKGFzeW5jICgpID0+IHsKICAgICAgYXdhaXQgcmVpbml0aWFsaXplRXhpc3RpbmdTZWxlY3RlZERycygpCiAgICB9KQoKICAgIG9uVW5tb3VudGVkKGFzeW5jICgpID0+IHsKICAgICAgYXdhaXQgcmVpbml0aWFsaXplRXhpc3RpbmdTZWxlY3RlZERycygpCiAgICB9KQoKICAgIHdhdGNoKGV4aXN0aW5nU2VsZWN0ZWREcnMsICgpID0+IHsKICAgICAgcmVpbml0aWFsaXplRXhpc3RpbmdTZWxlY3RlZERycygpCiAgICB9KQoKICAgIGNvbnN0IHN1Ym1pdCA9ICgpID0+IHsKICAgICAgZW1pdCgnc2VsZWN0ZWREcnMnLCBzZWxlY3RlZERycy52YWx1ZSkKICAgIH0KCiAgICBjb25zdCBjYW5jZWwgPSAoKSA9PiB7CiAgICAgIGVtaXQoJ2NhbmNlbCcpCiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgY2FuY2VsLAogICAgICBkYXRlRm9ybWF0MSwKICAgICAgc2VhcmNoLAogICAgICBzaG93U3VibWl0LAogICAgICBzdWJtaXQsCiAgICAgIGxpc3QsCiAgICAgIGxvYWRpbmcsCiAgICAgIHNlbGVjdGVkRHJzLAogICAgICBoZWFkZXJzOiBbCiAgICAgICAgewogICAgICAgICAgdGV4dDogJ0RhdGUnLAogICAgICAgICAgYWxpZ246ICdzdGFydCcsCiAgICAgICAgICBzb3J0YWJsZTogZmFsc2UsCiAgICAgICAgICB2YWx1ZTogJ2NyZWF0ZWRfYXQnLAogICAgICAgIH0sCiAgICAgICAgeyB0ZXh0OiAnRFIgTm8nLCB2YWx1ZTogJ3NhbGVzX2RyX251bWJlcicgfSwKICAgICAgICB7IHRleHQ6ICdSZW1haW5pbmcgQmFsYW5jZScsIHZhbHVlOiAncmVtYWluaW5nX2JhbGFuY2UnIH0sCiAgICAgIF0sCiAgICB9CiAgfSwKfQo="},{"version":3,"sources":["DrListSelection.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwFA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"DrListSelection.vue","sourceRoot":"src/views/pages/sales/collections","sourcesContent":["<template>\n  <v-card class=\"pa-10\">\n    <v-card-text>\n      <v-row>\n        <v-col\n          cols=\"12\"\n          class=\"pa-16\"\n        >\n          <v-data-table\n            v-model=\"selectedDrs\"\n            :items=\"list\"\n            :headers=\"headers\"\n            show-select\n            :loading=\"loading\"\n            :search=\"search\"\n          >\n            <template v-slot:top>\n              <v-toolbar\n                color=\"info\"\n                outlined\n              >\n                <v-toolbar-title style=\"color: white\">\n                  Sales DR List\n                </v-toolbar-title>\n                <v-divider\n                  class=\"mx-4\"\n                  inset\n                  vertical\n                ></v-divider>\n                <v-spacer></v-spacer>\n                <v-text-field\n                  v-model=\"search\"\n                  append-icon=\"mdi-magnify\"\n                  label=\"Search\"\n                  single-line\n                  hide-details\n                  class=\"mr-4\"\n                ></v-text-field>\n              </v-toolbar>\n            </template>\n            <template #item.created_at=\"{ item }\">\n              {{ dateFormat1(item.created_at) }}\n            </template>\n            <template #item.amount=\"{ item }\">\n              <v-currency-field\n                v-model=\"item.amount\"\n                disabled\n                prefix=\"PHP\"\n                class=\"text-green\"\n              >\n              </v-currency-field>\n            </template>\n            <template #footer>\n              <v-row class=\"mb-2 mt-2\">\n                <v-col\n                  cols=\"8\"\n                ></v-col>\n                <v-col\n                  cols=\"2\"\n                >\n                  <v-btn\n                    color=\"error\"\n                    @click=\"cancel\"\n                  >\n                    Cancel\n                  </v-btn>\n                </v-col>\n                <v-col\n                  cols=\"1\"\n                >\n                  <v-btn\n                    color=\"info\"\n                    class=\"\"\n                    @click=\"submit\"\n                  >\n                    Submit\n                  </v-btn>\n                </v-col>\n              </v-row>\n            </template>\n          </v-data-table>\n        </v-col>\n      </v-row>\n    </v-card-text>\n  </v-card>\n</template>\n\n<script>\nimport {\n  computed, ref, toRef, watch,\n  onMounted, onUnmounted,\n} from '@vue/composition-api'\nimport store from '@/store'\nimport { dateFormat1 } from '@/utils/time'\n\nexport default {\n  name: 'DrListSelection',\n  props: {\n    customerId: {\n      type: Number,\n      required: true,\n      default: null,\n    },\n    existingSelectedDr: {\n      type: Array,\n      required: false,\n      default: null,\n    },\n  },\n  setup(props, { emit }) {\n    const customerIdData = toRef(props, 'customerId')\n    const existingSelectedDrs = toRef(props, 'existingSelectedDr')\n    const selectedDrs = ref([])\n    const list = computed(() => store.state.SalesDrStore.items)\n    const loading = computed(() => store.state.SalesDrStore.loading)\n    const showSubmit = ref(false)\n    const search = ref()\n    const listRecompute = ref([])\n\n    const reinitializeExistingSelectedDrs = () => {\n      if (existingSelectedDrs.value.length === 0) {\n        selectedDrs.value = []\n        store.dispatch('SalesDrStore/drListByCustomer', customerIdData.value)\n\n        return\n      }\n\n      listRecompute.value = []\n      selectedDrs.value = []\n\n      existingSelectedDrs.value.forEach(item => {\n        list.value.forEach(listItem => {\n          const id = item.sales_dr?.id ?? item.id\n\n          const exist = (listItem.id === id) ? listItem : false\n\n          if (exist) {\n            listRecompute.value.push(exist)\n            selectedDrs.value.push(exist)\n          } else {\n            listRecompute.value.push(listItem)\n          }\n        })\n      })\n\n      store.dispatch('SalesDrStore/updateOrderItems', listRecompute.value)\n    }\n\n    onMounted(async () => {\n      await reinitializeExistingSelectedDrs()\n    })\n\n    onUnmounted(async () => {\n      await reinitializeExistingSelectedDrs()\n    })\n\n    watch(existingSelectedDrs, () => {\n      reinitializeExistingSelectedDrs()\n    })\n\n    const submit = () => {\n      emit('selectedDrs', selectedDrs.value)\n    }\n\n    const cancel = () => {\n      emit('cancel')\n    }\n\n    return {\n      cancel,\n      dateFormat1,\n      search,\n      showSubmit,\n      submit,\n      list,\n      loading,\n      selectedDrs,\n      headers: [\n        {\n          text: 'Date',\n          align: 'start',\n          sortable: false,\n          value: 'created_at',\n        },\n        { text: 'DR No', value: 'sales_dr_number' },\n        { text: 'Remaining Balance', value: 'remaining_balance' },\n      ],\n    }\n  },\n}\n</script>\n\n<style scoped>\n\n</style>\n"]}]}