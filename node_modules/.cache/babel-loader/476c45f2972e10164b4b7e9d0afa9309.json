{"remainingRequest":"/Users/mark/projects/enco-fe/node_modules/babel-loader/lib/index.js!/Users/mark/projects/enco-fe/src/interceptors/axios.js","dependencies":[{"path":"/Users/mark/projects/enco-fe/src/interceptors/axios.js","mtime":1655103817543},{"path":"/Users/mark/projects/enco-fe/node_modules/cache-loader/dist/cjs.js","mtime":1654587530817},{"path":"/Users/mark/projects/enco-fe/node_modules/babel-loader/lib/index.js","mtime":1654587530760}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIi9Vc2Vycy9tYXJrL3Byb2plY3RzL2VuY28tZmUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZS5qcyI7CmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7CmF4aW9zLmRlZmF1bHRzLmJhc2VVUkwgPSAnaHR0cDovL2xvY2FsaG9zdC9hcGkvJzsKYXhpb3MuaW50ZXJjZXB0b3JzLnJlc3BvbnNlLnVzZShmdW5jdGlvbiAocmVzcG9uc2UpIHsKICByZXR1cm4gcmVzcG9uc2U7Cn0sIC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgdmFyIF9yZWYgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoZXJyb3IpIHsKICAgIHZhciBfd2luZG93JGxvY2FsU3RvcmFnZSQ7CgogICAgdmFyIG9yaWdpbmFsUmVxdWVzdCwgYWNjZXNzVG9rZW4sIF95aWVsZCRheGlvcyRwb3N0LCBzdGF0dXMsIGRhdGE7CgogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBvcmlnaW5hbFJlcXVlc3QgPSB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oJ29yaWdpbmFsX3JlcXVlc3QnKTsKICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSAoX3dpbmRvdyRsb2NhbFN0b3JhZ2UkID0gd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKCdhY2Nlc3NfdG9rZW4nKSkgIT09IG51bGwgJiYgX3dpbmRvdyRsb2NhbFN0b3JhZ2UkICE9PSB2b2lkIDAgPyBfd2luZG93JGxvY2FsU3RvcmFnZSQgOiBudWxsOwoKICAgICAgICAgICAgaWYgKCEoYWNjZXNzVG9rZW4gPT09IG51bGwpKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDY7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJyMvbG9naW4nOwogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjU7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgaWYgKCEoZXJyb3IucmVzcG9uc2Uuc3RhdHVzID09PSA0MjIgfHwgZXJyb3IucmVzcG9uc2Uuc3RhdHVzID09PSA1MDApKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDEwOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICBpZiAoIShlcnJvci5yZXNwb25zZS5zdGF0dXMgPT09IDQwMSAmJiBvcmlnaW5hbFJlcXVlc3QgPT09IHRydWUpKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDIzOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTM7CiAgICAgICAgICAgIHJldHVybiBheGlvcy5wb3N0KCdyZWZyZXNoLXRva2VuJywgewogICAgICAgICAgICAgIHJlZnJlc2hfdG9rZW46IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgncmVmcmVzaF90b2tlbicpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgIF95aWVsZCRheGlvcyRwb3N0ID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgc3RhdHVzID0gX3lpZWxkJGF4aW9zJHBvc3Quc3RhdHVzOwogICAgICAgICAgICBkYXRhID0gX3lpZWxkJGF4aW9zJHBvc3QuZGF0YTsKICAgICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKCdvcmlnaW5hbF9yZXF1ZXN0JywgJ2ZhbHNlJyk7CgogICAgICAgICAgICBpZiAoIShzdGF0dXMgPT09IDIwMCkpIHsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjE7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnYWNjZXNzX3Rva2VuJywgZGF0YS5hY2Nlc3NfdG9rZW4pOwogICAgICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3JlZnJlc2hfdG9rZW4nLCBkYXRhLnJlZnJlc2hfdG9rZW4pOyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY29uc2lzdGVudC1yZXR1cm4KCiAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIGF4aW9zKGVycm9yLmNvbmZpZykpOwoKICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyNTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAyMzoKICAgICAgICAgICAgbG9jYWxTdG9yYWdlLmNsZWFyKCk7CiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJyMvbG9naW4nOwoKICAgICAgICAgIGNhc2UgMjU6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIGVycm9yKTsKCiAgICAgICAgICBjYXNlIDI2OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUpOwogIH0pKTsKCiAgcmV0dXJuIGZ1bmN0aW9uIChfeCkgewogICAgcmV0dXJuIF9yZWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9Owp9KCkpOw=="},{"version":3,"sources":["/Users/mark/projects/enco-fe/src/interceptors/axios.js"],"names":["axios","defaults","baseURL","interceptors","response","use","error","originalRequest","window","localStorage","getItem","accessToken","location","href","status","post","refresh_token","data","setItem","access_token","config","clear"],"mappings":";;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AAEAA,KAAK,CAACC,QAAN,CAAeC,OAAf,GAAyB,uBAAzB;AAEAF,KAAK,CAACG,YAAN,CAAmBC,QAAnB,CAA4BC,GAA5B,CAAgC,UAAAD,QAAQ;AAAA,SAAIA,QAAJ;AAAA,CAAxC;AAAA,qEAAsD,iBAAME,KAAN;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAC9CC,YAAAA,eAD8C,GAC5BC,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,kBAA5B,CAD4B;AAE9CC,YAAAA,WAF8C,4BAEhCH,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,cAA5B,CAFgC,yEAEe,IAFf;;AAAA,kBAIhDC,WAAW,KAAK,IAJgC;AAAA;AAAA;AAAA;;AAKlDH,YAAAA,MAAM,CAACI,QAAP,CAAgBC,IAAhB,GAAuB,SAAvB;AALkD;AAAA;;AAAA;AAAA,kBAMzCP,KAAK,CAACF,QAAN,CAAeU,MAAf,KAA0B,GAA1B,IAAiCR,KAAK,CAACF,QAAN,CAAeU,MAAf,KAA0B,GANlB;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA,kBAQzCR,KAAK,CAACF,QAAN,CAAeU,MAAf,KAA0B,GAA1B,IAAiCP,eAAe,KAAK,IARZ;AAAA;AAAA;AAAA;;AAAA;AAAA,mBASnBP,KAAK,CAACe,IAAN,CAAW,eAAX,EAA4B;AACzDC,cAAAA,aAAa,EAAER,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,eAA5B;AAD0C,aAA5B,CATmB;;AAAA;AAAA;AAS1CI,YAAAA,MAT0C,qBAS1CA,MAT0C;AASlCG,YAAAA,IATkC,qBASlCA,IATkC;AAalDT,YAAAA,MAAM,CAACC,YAAP,CAAoBS,OAApB,CAA4B,kBAA5B,EAAgD,OAAhD;;AAbkD,kBAe9CJ,MAAM,KAAK,GAfmC;AAAA;AAAA;AAAA;;AAgBhDN,YAAAA,MAAM,CAACC,YAAP,CAAoBS,OAApB,CAA4B,cAA5B,EAA4CD,IAAI,CAACE,YAAjD;AACAX,YAAAA,MAAM,CAACC,YAAP,CAAoBS,OAApB,CAA4B,eAA5B,EAA6CD,IAAI,CAACD,aAAlD,EAjBgD,CAmBhD;;AAnBgD,6CAoBzChB,KAAK,CAACM,KAAK,CAACc,MAAP,CApBoC;;AAAA;AAAA;AAAA;;AAAA;AAuBlDX,YAAAA,YAAY,CAACY,KAAb;AACAb,YAAAA,MAAM,CAACI,QAAP,CAAgBC,IAAhB,GAAuB,SAAvB;;AAxBkD;AAAA,6CA4B7CP,KA5B6C;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAtD;;AAAA;AAAA;AAAA;AAAA","sourcesContent":["import axios from 'axios'\n\naxios.defaults.baseURL = 'http://localhost/api/'\n\naxios.interceptors.response.use(response => response, async error => {\n  const originalRequest = window.localStorage.getItem('original_request')\n  const accessToken = window.localStorage.getItem('access_token') ?? null\n\n  if (accessToken === null) {\n    window.location.href = '#/login'\n  } else if (error.response.status === 422 || error.response.status === 500) {\n    return\n  } else if (error.response.status === 401 && originalRequest === true) {\n    const { status, data } = await axios.post('refresh-token', {\n      refresh_token: window.localStorage.getItem('refresh_token'),\n    })\n\n    window.localStorage.setItem('original_request', 'false')\n\n    if (status === 200) {\n      window.localStorage.setItem('access_token', data.access_token)\n      window.localStorage.setItem('refresh_token', data.refresh_token)\n\n      // eslint-disable-next-line consistent-return\n      return axios(error.config)\n    }\n  } else {\n    localStorage.clear()\n    window.location.href = '#/login'\n  }\n\n  // eslint-disable-next-line consistent-return\n  return error\n})\n"]}]}