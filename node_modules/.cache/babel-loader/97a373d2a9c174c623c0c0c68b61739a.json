{"remainingRequest":"/Users/mark/projects/enco-fe/node_modules/babel-loader/lib/index.js!/Users/mark/projects/enco-fe/node_modules/cache-loader/dist/cjs.js??ref--1-0!/Users/mark/projects/enco-fe/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/mark/projects/enco-fe/src/views/pages/user-access-management/users/UserAbilitiesForm.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/mark/projects/enco-fe/src/views/pages/user-access-management/users/UserAbilitiesForm.vue","mtime":1661256506862},{"path":"/Users/mark/projects/enco-fe/babel.config.js","mtime":1655991784146},{"path":"/Users/mark/projects/enco-fe/node_modules/cache-loader/dist/cjs.js","mtime":1650363912993},{"path":"/Users/mark/projects/enco-fe/node_modules/babel-loader/lib/index.js","mtime":1652172763063},{"path":"/Users/mark/projects/enco-fe/node_modules/cache-loader/dist/cjs.js","mtime":1650363912993},{"path":"/Users/mark/projects/enco-fe/node_modules/vue-loader/lib/index.js","mtime":1650363919730}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9yZWdlbmVyYXRvclJ1bnRpbWUgZnJvbSAiL1VzZXJzL21hcmsvcHJvamVjdHMvZW5jby1mZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vcmVnZW5lcmF0b3JSdW50aW1lLmpzIjsKaW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIi9Vc2Vycy9tYXJrL3Byb2plY3RzL2VuY28tZmUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAuanMiOwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwppbXBvcnQgeyBtZGlBbGVydE91dGxpbmUsIG1kaUNsb3VkVXBsb2FkT3V0bGluZSwgbWRpSHVtYW5FZGl0IH0gZnJvbSAnQG1kaS9qcyc7CmltcG9ydCB7IHRvUmVmLCBvbk1vdW50ZWQsIHJlZiwgd2F0Y2ggfSBmcm9tICdAdnVlL2NvbXBvc2l0aW9uLWFwaSc7CmltcG9ydCByb3V0ZXIgZnJvbSAnQC9yb3V0ZXInOwppbXBvcnQgc3RvcmUgZnJvbSAnQC9zdG9yZSc7CmltcG9ydCBVc2VyQWNjZXNzTWFuYWdlbWVudFNlcnZpY2UgZnJvbSAnQC9zZXJ2aWNlL1VzZXJBY2Nlc3NNYW5hZ2VtZW50U2VydmljZSc7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnVXNlckFiaWxpdGllc0Zvcm1WdWUnLAogIHByb3BzOiB7CiAgICB1c2VyOiB7CiAgICAgIHR5cGU6IE9iamVjdCwKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgIH0sCiAgICBsb2FkaW5nOiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IHRydWUsCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICB9CiAgfSwKICBzZXR1cDogZnVuY3Rpb24gc2V0dXAocHJvcHMpIHsKICAgIHZhciBzZXJ2aWNlID0gbmV3IFVzZXJBY2Nlc3NNYW5hZ2VtZW50U2VydmljZSgpOwogICAgdmFyIHVzZXJEYXRhID0gdG9SZWYocHJvcHMsICd1c2VyJyk7CiAgICB2YXIgYWJpbGl0aWVzT3B0aW9ucyA9IHJlZihbXSk7CiAgICB2YXIgcm9sZU9wdGlvbnMgPSByZWYoW10pOwogICAgdmFyIGFiaWxpdGllc1NlbGVjdGVkID0gcmVmKFtdKTsKICAgIHZhciBsb2FkaW5nTG9jYWxlID0gdG9SZWYocHJvcHMsICdsb2FkaW5nJyk7CiAgICB2YXIgc2hvd0FsZXJ0ID0gcmVmKGZhbHNlKTsKICAgIHZhciBsb2FkaW5nQWJpbGl0aWVzID0gcmVmKHRydWUpOwogICAgd2F0Y2godXNlckRhdGEsIGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICBhYmlsaXRpZXNTZWxlY3RlZC52YWx1ZSA9IHZhbHVlLmFiaWxpdGllcy5tYXAoZnVuY3Rpb24gKGFiaWxpdHkpIHsKICAgICAgICByZXR1cm4gYWJpbGl0eS5pZDsKICAgICAgfSk7CiAgICB9KTsKICAgIG9uTW91bnRlZCggLyojX19QVVJFX18qL19hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSgpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIGlmICghKHVzZXJEYXRhLnZhbHVlLmRlcGFydG1lbnRfaWQgPT09IG51bGwpKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDM7CiAgICAgICAgICAgICAgcmV0dXJuIHNlcnZpY2UuZ2V0QWJpbGl0aWVzKHRydWUpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICBhYmlsaXRpZXNPcHRpb25zLnZhbHVlID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgICAgIGFiaWxpdGllc1NlbGVjdGVkLnZhbHVlID0gdXNlckRhdGEudmFsdWUuYWJpbGl0aWVzLm1hcChmdW5jdGlvbiAoYWJpbGl0eSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gYWJpbGl0eS5pZDsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgbG9hZGluZ0FiaWxpdGllcy52YWx1ZSA9IGZhbHNlOwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA1OwogICAgICAgICAgICAgIHJldHVybiBzZXJ2aWNlLmdldFJvbGVzKCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgIHJvbGVPcHRpb25zLnZhbHVlID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDk7CiAgICAgICAgICAgICAgcmV0dXJuIHNlcnZpY2UuZ2V0RGVwYXJ0bWVudEFiaWxpdGllcyh1c2VyRGF0YS52YWx1ZS5kZXBhcnRtZW50X2lkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgYWJpbGl0aWVzT3B0aW9ucy52YWx1ZSA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgICAgICBhYmlsaXRpZXNTZWxlY3RlZC52YWx1ZSA9IHVzZXJEYXRhLnZhbHVlLmFiaWxpdGllcy5tYXAoZnVuY3Rpb24gKGFiaWxpdHkpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGFiaWxpdHkuaWQ7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGxvYWRpbmdBYmlsaXRpZXMudmFsdWUgPSBmYWxzZTsKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgcmV0dXJuIHNlcnZpY2UuZ2V0RGVwYXJ0bWVudFJvbGVzKHVzZXJEYXRhLnZhbHVlLmRlcGFydG1lbnRfaWQpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICByb2xlT3B0aW9ucy52YWx1ZSA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlKTsKICAgIH0pKSk7CgogICAgdmFyIGdvQmFjayA9IGZ1bmN0aW9uIGdvQmFjaygpIHsKICAgICAgcm91dGVyLnB1c2goJy91c2VycycpOwogICAgfTsKCiAgICB2YXIgc3VibWl0ID0gZnVuY3Rpb24gc3VibWl0KCkgewogICAgICBzdG9yZS5kaXNwYXRjaCgnVXNlckFjY2Vzc01hbmFnZW1lbnRTdG9yZS91cGRhdGVVc2VyJywgewogICAgICAgIHJvbGVfaWQ6IHVzZXJEYXRhLnZhbHVlLnJvbGVfaWQsCiAgICAgICAgYWJpbGl0aWVzOiBhYmlsaXRpZXNTZWxlY3RlZC52YWx1ZSwKICAgICAgICBpZDogdXNlckRhdGEudmFsdWUuaWQKICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHNob3dBbGVydC52YWx1ZSA9IHRydWU7CiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgc2hvd0FsZXJ0LnZhbHVlID0gZmFsc2U7CiAgICAgICAgICB9LCAxNTAwKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfTsKCiAgICByZXR1cm4gewogICAgICBhYmlsaXRpZXNPcHRpb25zOiBhYmlsaXRpZXNPcHRpb25zLAogICAgICBhYmlsaXRpZXNTZWxlY3RlZDogYWJpbGl0aWVzU2VsZWN0ZWQsCiAgICAgIGxvYWRpbmdBYmlsaXRpZXM6IGxvYWRpbmdBYmlsaXRpZXMsCiAgICAgIGxvYWRpbmdMb2NhbGU6IGxvYWRpbmdMb2NhbGUsCiAgICAgIGljb25zOiB7CiAgICAgICAgbWRpQWxlcnRPdXRsaW5lOiBtZGlBbGVydE91dGxpbmUsCiAgICAgICAgbWRpQ2xvdWRVcGxvYWRPdXRsaW5lOiBtZGlDbG91ZFVwbG9hZE91dGxpbmUsCiAgICAgICAgbWRpSHVtYW5FZGl0OiBtZGlIdW1hbkVkaXQKICAgICAgfSwKICAgICAgZ29CYWNrOiBnb0JhY2ssCiAgICAgIHJvbGVPcHRpb25zOiByb2xlT3B0aW9ucywKICAgICAgc2hvd0FsZXJ0OiBzaG93QWxlcnQsCiAgICAgIHN1Ym1pdDogc3VibWl0LAogICAgICB1c2VyRGF0YTogdXNlckRhdGEKICAgIH07CiAgfQp9Ow=="},{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiFA;AACA,SACAA,KADA,EAEAC,SAFA,EAGAC,GAHA,EAIAC,KAJA,QAKA,sBALA;AAMA;AACA;AACA;AAEA;EACAC,4BADA;EAEAC;IACAC;MACAC,YADA;MAEAC;IAFA,CADA;IAKAC;MACAF,aADA;MAEAG,aAFA;MAGAF;IAHA;EALA,CAFA;EAaAG,KAbA,iBAaAN,KAbA,EAaA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IAEAF;MACAS;QAAA;MAAA;IACA,CAFA;IAIAX;MAAA;QAAA;UAAA;YAAA;cAAA,MACAY,qCADA;gBAAA;gBAAA;cAAA;;cAAA;cAAA,OAEAC,2BACAC,IADA,CACA;gBACAC;gBACAJ;kBAAA;gBAAA;gBACAK;cACA,CALA,CAFA;;YAAA;cAAA;cAAA,OASAH,mBACAC,IADA,CACA;gBACAG;cACA,CAHA,CATA;;YAAA;cAAA;cAAA;;YAAA;cAAA;cAAA,OAcAJ,6DACAC,IADA,CACA;gBACAC;gBACAJ;kBAAA;gBAAA;gBACAK;cACA,CALA,CAdA;;YAAA;cAAA;cAAA,OAqBAH,yDACAC,IADA,CACA;gBACAG;cACA,CAHA,CArBA;;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA;;IA4BA;MACAC;IACA,CAFA;;IAIA;MACAC;QACAC,+BADA;QAEAC,kCAFA;QAGAC;MAHA,GAIAR,IAJA,CAKA;QACA;UACAS;UACAC;YACAD;UACA,CAFA,EAEA,IAFA;QAGA;MACA,CAZA;IAcA,CAfA;;IAiBA;MACAR,kCADA;MAEAJ,oCAFA;MAGAK,kCAHA;MAIAS,4BAJA;MAKAC;QACAC,gCADA;QAEAC,4CAFA;QAGAC;MAHA,CALA;MAUAC,cAVA;MAWAb,wBAXA;MAYAM,oBAZA;MAaAQ,cAbA;MAcAnB;IAdA;EAgBA;AA5FA","names":["toRef","onMounted","ref","watch","name","props","user","type","required","loading","default","setup","abilitiesSelected","userData","service","then","abilitiesOptions","loadingAbilities","roleOptions","router","store","role_id","abilities","id","showAlert","setTimeout","loadingLocale","icons","mdiAlertOutline","mdiCloudUploadOutline","mdiHumanEdit","goBack","submit"],"sourceRoot":"src/views/pages/user-access-management/users","sources":["UserAbilitiesForm.vue"],"sourcesContent":["<template>\n  <v-card\n    flat\n    class=\"pa-3 mt-2\"\n  >\n    <v-alert\n      v-show=\"showAlert\"\n      dense\n      text\n      type=\"success\"\n      dismissible\n    >\n      Successfully updated\n    </v-alert>\n    <v-card-text>\n      <v-progress-linear\n        v-if=\"loadingLocale || loadingAbilities\"\n        indeterminate\n        color=\"primary\"\n      ></v-progress-linear>\n      <v-form\n        v-if=\"!loadingLocale && !loadingAbilities\"\n        class=\"multi-col-validation mt-6\"\n      >\n        <v-row>\n          <v-col\n            cols=\"12\"\n            md=\"6\"\n          >\n            <v-select\n              v-model=\"userData.role_id\"\n              dense\n              outlined\n              :prepend-inner-icon=\"icons.mdiHumanEdit\"\n              item-text=\"title\"\n              item-value=\"id\"\n              label=\"Role\"\n              :items=\"roleOptions\"\n            ></v-select>\n          </v-col>\n\n          <v-col\n            cols=\"12\"\n            md=\"9\"\n          >\n            <v-treeview\n              v-model=\"abilitiesSelected\"\n              selectable\n              selected-color=\"primary\"\n              item-disabled=\"locked\"\n              item-key=\"id\"\n              item-text=\"name\"\n              item-children=\"abilities\"\n              :items=\"abilitiesOptions\"\n            ></v-treeview>\n          </v-col>\n\n          <v-col cols=\"12\">\n            <v-btn\n              color=\"primary\"\n              class=\"me-3 mt-4\"\n              @click=\"submit\"\n            >\n              Save changes\n            </v-btn>\n            <v-btn\n              color=\"info\"\n              outlined\n              class=\"mt-3\"\n              type=\"reset\"\n              @click.prevent=\"goBack\"\n            >\n              Back to Users Page\n            </v-btn>\n          </v-col>\n        </v-row>\n      </v-form>\n    </v-card-text>\n  </v-card>\n</template>\n<script>\nimport { mdiAlertOutline, mdiCloudUploadOutline, mdiHumanEdit } from '@mdi/js'\nimport {\n  toRef,\n  onMounted,\n  ref,\n  watch\n} from '@vue/composition-api'\nimport router from '@/router'\nimport store from '@/store'\nimport UserAccessManagementService from '@/service/UserAccessManagementService'\n\nexport default {\n  name: 'UserAbilitiesFormVue',\n  props: {\n    user: {\n      type: Object,\n      required: true,\n    },\n    loading: {\n      type: Boolean,\n      default: true,\n      required: true,\n    },\n  },\n  setup(props) {\n    const service = new UserAccessManagementService()\n    const userData = toRef(props, 'user')\n    const abilitiesOptions = ref([])\n    const roleOptions = ref([])\n    const abilitiesSelected = ref([])\n    const loadingLocale = toRef(props, 'loading')\n    const showAlert = ref(false)\n    const loadingAbilities = ref(true)\n\n    watch(userData, value => {\n      abilitiesSelected.value = value.abilities.map(ability => ability.id)\n    })\n\n    onMounted(async () => {\n      if (userData.value.department_id === null) {\n        await service.getAbilities(true)\n          .then(response => {\n            abilitiesOptions.value = response.data\n            abilitiesSelected.value = userData.value.abilities.map(ability => ability.id)\n            loadingAbilities.value = false\n          })\n\n        await service.getRoles()\n          .then(response => {\n            roleOptions.value = response.data\n          })\n      } else {\n        await service.getDepartmentAbilities(userData.value.department_id)\n          .then(response => {\n            abilitiesOptions.value = response.data\n            abilitiesSelected.value = userData.value.abilities.map(ability => ability.id)\n            loadingAbilities.value = false\n          })\n\n        await service.getDepartmentRoles(userData.value.department_id)\n          .then(response => {\n            roleOptions.value = response.data\n          })\n      }\n    })\n\n    const goBack = () => {\n      router.push('/users')\n    }\n\n    const submit = () => {\n      store.dispatch('UserAccessManagementStore/updateUser', {\n        role_id: userData.value.role_id,\n        abilities: abilitiesSelected.value,\n        id: userData.value.id,\n      }).then(\n        response => {\n          if (response.status === undefined) {\n            showAlert.value = true\n            setTimeout(() => {\n              showAlert.value = false\n            }, 1500)\n          }\n        },\n      )\n    }\n\n    return {\n      abilitiesOptions,\n      abilitiesSelected,\n      loadingAbilities,\n      loadingLocale,\n      icons: {\n        mdiAlertOutline,\n        mdiCloudUploadOutline,\n        mdiHumanEdit,\n      },\n      goBack,\n      roleOptions,\n      showAlert,\n      submit,\n      userData,\n    }\n  },\n}\n</script>\n\n<style scoped>\n\n</style>\n"]}]}