{"remainingRequest":"/Users/mark/projects/enco-fe/node_modules/babel-loader/lib/index.js!/Users/mark/projects/enco-fe/node_modules/cache-loader/dist/cjs.js??ref--1-0!/Users/mark/projects/enco-fe/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/mark/projects/enco-fe/src/views/pages/sales/collections/CollectionForm.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/mark/projects/enco-fe/src/views/pages/sales/collections/CollectionForm.vue","mtime":1666366542659},{"path":"/Users/mark/projects/enco-fe/babel.config.js","mtime":1655991784146},{"path":"/Users/mark/projects/enco-fe/node_modules/cache-loader/dist/cjs.js","mtime":1665368576185},{"path":"/Users/mark/projects/enco-fe/node_modules/babel-loader/lib/index.js","mtime":1665368576151},{"path":"/Users/mark/projects/enco-fe/node_modules/cache-loader/dist/cjs.js","mtime":1665368576185},{"path":"/Users/mark/projects/enco-fe/node_modules/vue-loader/lib/index.js","mtime":1665368593779}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF90b0FycmF5IGZyb20gIi9Vc2Vycy9tYXJrL3Byb2plY3RzL2VuY28tZmUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3RvQXJyYXkuanMiOwppbXBvcnQgX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIgZnJvbSAiL1VzZXJzL21hcmsvcHJvamVjdHMvZW5jby1mZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlci5qcyI7CmltcG9ydCBfcmVnZW5lcmF0b3JSdW50aW1lIGZyb20gIi9Vc2Vycy9tYXJrL3Byb2plY3RzL2VuY28tZmUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3JlZ2VuZXJhdG9yUnVudGltZS5qcyI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICIvVXNlcnMvbWFyay9wcm9qZWN0cy9lbmNvLWZlL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5uYW1lLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maW5kLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maWx0ZXIuanMiOwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwppbXBvcnQgeyBjb21wdXRlZCwgb25Vbm1vdW50ZWQsIHJlZiwgdG9SZWYsIHdhdGNoIH0gZnJvbSAnQHZ1ZS9jb21wb3NpdGlvbi1hcGknOwppbXBvcnQgeyBtZGlBY2NvdW50UGx1c091dGxpbmUsIG1kaUNhcmRPZmYsIG1kaUN1cnJlbmN5U2lnbiwgbWRpSW5mb3JtYXRpb24gfSBmcm9tICdAbWRpL2pzJzsKaW1wb3J0IEN1c3RvbWVyRm9ybSBmcm9tICdAL3ZpZXdzL3BhZ2VzL21hc3Rlci1maWxlcy9jdXN0b21lcnMvQ3VzdG9tZXJGb3JtLnZ1ZSc7CmltcG9ydCBzdG9yZSBmcm9tICdAL3N0b3JlJzsKaW1wb3J0IERyTGlzdFNlbGVjdGlvbiBmcm9tICdAL3ZpZXdzL3BhZ2VzL3NhbGVzL2NvbGxlY3Rpb25zL0RyTGlzdFNlbGVjdGlvbi52dWUnOwppbXBvcnQgeyBRcmNvZGVTdHJlYW0gfSBmcm9tICd2dWUtcXJjb2RlLXJlYWRlcic7CmltcG9ydCBTYWxlc0RyVGFibGUgZnJvbSAnLi9TYWxlc0RyVGFibGUudnVlJzsKaW1wb3J0IENvbGxlY3Rpb25QYXltZW50IGZyb20gJy4vQ29sbGVjdGlvblBheW1lbnQudnVlJzsKaW1wb3J0IFBheW1lbnRGb3JtIGZyb20gJy4vUGF5bWVudEZvcm0udnVlJzsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdDb2xsZWN0aW9uRm9ybScsCiAgY29tcG9uZW50czogewogICAgQ3VzdG9tZXJGb3JtOiBDdXN0b21lckZvcm0sCiAgICBTYWxlc0RyVGFibGU6IFNhbGVzRHJUYWJsZSwKICAgIENvbGxlY3Rpb25QYXltZW50OiBDb2xsZWN0aW9uUGF5bWVudCwKICAgIERyTGlzdFNlbGVjdGlvbjogRHJMaXN0U2VsZWN0aW9uLAogICAgUGF5bWVudEZvcm06IFBheW1lbnRGb3JtLAogICAgUXJjb2RlU3RyZWFtOiBRcmNvZGVTdHJlYW0KICB9LAogIHByb3BzOiB7CiAgICBtb2RlOiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgIGRlZmF1bHQ6IGZ1bmN0aW9uIF9kZWZhdWx0KCkgewogICAgICAgIHJldHVybiAnQ3JlYXRlJzsKICAgICAgfQogICAgfSwKICAgIGRhdGE6IHsKICAgICAgdHlwZTogT2JqZWN0LAogICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgIGRlZmF1bHQ6IG51bGwKICAgIH0KICB9LAogIHNldHVwOiBmdW5jdGlvbiBzZXR1cChwcm9wcywgX3JlZikgewogICAgdmFyIF9mb3JtRGF0YSR2YWx1ZSRzYWxlczI7CgogICAgdmFyIGVtaXQgPSBfcmVmLmVtaXQ7CiAgICBzdG9yZS5kaXNwYXRjaCgnVGVybVN0b3JlL2xpc3QnKTsKICAgIHN0b3JlLmRpc3BhdGNoKCdWYXRTdG9yZS9saXN0Jyk7CiAgICBzdG9yZS5kaXNwYXRjaCgnU2FsZXNtYW5TdG9yZS9saXN0Jyk7CiAgICBzdG9yZS5kaXNwYXRjaCgnRG9jdW1lbnRTdG9yZS9saXN0Jyk7CiAgICB2YXIgbW9kZURhdGEgPSB0b1JlZihwcm9wcywgJ21vZGUnKTsKICAgIHZhciBkYXRlUG9zdGVkID0gcmVmKG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zdWJzdHIoMCwgMTApKTsKICAgIHZhciBkYXRhUHJvcCA9IHRvUmVmKHByb3BzLCAnZGF0YScpOwogICAgdmFyIGN1c3RvbWVyTW9kYWwgPSByZWYoZmFsc2UpOwogICAgdmFyIGRyTGlzdE1vZGFsID0gcmVmKGZhbHNlKTsKICAgIHZhciBwYXltZW50TW9kYWwgPSByZWYoZmFsc2UpOwogICAgdmFyIHNob3dTY2FubmVyID0gcmVmKGZhbHNlKTsKICAgIHZhciBzYWxlc0RyTGlzdCA9IHJlZihbXSk7CiAgICB2YXIgZm9ybURhdGEgPSByZWYoewogICAgICBkYXRlTW9kYWw6IGZhbHNlLAogICAgICBjdXN0b21lcl9uYW1lOiBudWxsLAogICAgICBjdXN0b21lcl9pZDogMCwKICAgICAgZGF0ZV9wb3N0ZWQ6IG51bGwsCiAgICAgIGNvbGxlY3Rpb25fb3JkZXJfbnVtYmVyOiBudWxsLAogICAgICBkb2N1bWVudF9pZDogbnVsbCwKICAgICAgYWRkcmVzczogbnVsbCwKICAgICAgcmVtYXJrczogbnVsbCwKICAgICAgYXJlYTogbnVsbCwKICAgICAgc2FsZXNtYW5faWRfMTogbnVsbCwKICAgICAgc2FsZXNtYW5faWRfMjogbnVsbCwKICAgICAgdGVybV9pZDogbnVsbCwKICAgICAgdmF0X2lkOiBudWxsCiAgICB9KTsKICAgIHZhciBwYXltZW50V2FybmluZyA9IHJlZihmYWxzZSk7CiAgICB2YXIgdG90YWxBbW91bnQgPSByZWYoMCk7CiAgICB2YXIgcGF5bWVudHMgPSByZWYoW10pOwoKICAgIHZhciBwYXltZW50c1JlaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIHBheW1lbnRzUmVpbml0aWFsaXplKCkgewogICAgICB2YXIgX2Zvcm1EYXRhJHZhbHVlJHBheW1lOwoKICAgICAgaWYgKCgoX2Zvcm1EYXRhJHZhbHVlJHBheW1lID0gZm9ybURhdGEudmFsdWUucGF5bWVudHMpID09PSBudWxsIHx8IF9mb3JtRGF0YSR2YWx1ZSRwYXltZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Zvcm1EYXRhJHZhbHVlJHBheW1lLmxlbmd0aCkgPiAwKSB7CiAgICAgICAgcGF5bWVudHMudmFsdWUgPSBmb3JtRGF0YS52YWx1ZS5wYXltZW50cy5tYXAoZnVuY3Rpb24gKHBheW1lbnQpIHsKICAgICAgICAgIGlmIChwYXltZW50LnBheW1lbnRfdHlwZS5pbmNsdWRlcygnQ2FzaFBheW1lbnQnKSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcGFyYW0tcmVhc3NpZ24KICAgICAgICAgICAgcGF5bWVudC5wYXltZW50X3R5cGUgPSAnQ2FzaCBQYXltZW50JzsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAocGF5bWVudC5wYXltZW50X3R5cGUuaW5jbHVkZXMoJ0NoZWNrUGF5bWVudCcpID09PSB0cnVlKSB7CiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1wYXJhbS1yZWFzc2lnbgogICAgICAgICAgICBwYXltZW50LnBheW1lbnRfdHlwZSA9ICdDaGVjayBQYXltZW50JzsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAocGF5bWVudC5wYXltZW50X3R5cGUuaW5jbHVkZXMoJ09ubGluZVBheW1lbnQnKSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcGFyYW0tcmVhc3NpZ24KICAgICAgICAgICAgcGF5bWVudC5wYXltZW50X3R5cGUgPSAnT25saW5lIFBheW1lbnQnOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBwYXltZW50OwogICAgICAgIH0pOwogICAgICB9CiAgICB9OwoKICAgIGlmIChtb2RlRGF0YS52YWx1ZSA9PT0gJ0VkaXQnKSB7CiAgICAgIHZhciBfZm9ybURhdGEkdmFsdWUkc2FsZXM7CgogICAgICBmb3JtRGF0YS52YWx1ZSA9IGRhdGFQcm9wLnZhbHVlOwogICAgICBmb3JtRGF0YS52YWx1ZS5jdXN0b21lcl9uYW1lID0gZGF0YVByb3AudmFsdWUuY3VzdG9tZXIubmFtZTsKICAgICAgZm9ybURhdGEudmFsdWUuY3VzdG9tZXJfaWQgPSBkYXRhUHJvcC52YWx1ZS5jdXN0b21lci5pZDsKICAgICAgZm9ybURhdGEudmFsdWUudHlwZSA9IGRhdGFQcm9wLnZhbHVlLmN1c3RvbWVyLnR5cGU7CgogICAgICBpZiAoKChfZm9ybURhdGEkdmFsdWUkc2FsZXMgPSBmb3JtRGF0YS52YWx1ZS5zYWxlc19kcl9wYXltZW50cykgPT09IG51bGwgfHwgX2Zvcm1EYXRhJHZhbHVlJHNhbGVzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZm9ybURhdGEkdmFsdWUkc2FsZXMubGVuZ3RoKSA+IDApIHsKICAgICAgICBzYWxlc0RyTGlzdC52YWx1ZSA9IFtdOwogICAgICAgIHNhbGVzRHJMaXN0LnZhbHVlID0gZm9ybURhdGEudmFsdWUuc2FsZXNfZHJfcGF5bWVudHMubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICBpdGVtID0gaXRlbS5zYWxlc19kcjsKCiAgICAgICAgICBpZiAoaXRlbS5yZW1haW5pbmdfYmFsYW5jZSkgewogICAgICAgICAgICBpdGVtLnJlbWFpbmluZ19iYWxhbmNlID0gcGFyc2VGbG9hdChpdGVtLnJlbWFpbmluZ19iYWxhbmNlKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gaXRlbTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgcGF5bWVudHNSZWluaXRpYWxpemUoKTsKICAgICAgc3RvcmUuZGlzcGF0Y2goJ1NhbGVzRHJTdG9yZS9kckxpc3RCeUN1c3RvbWVyJywgZm9ybURhdGEudmFsdWUuY3VzdG9tZXIuaWQpOwogICAgfSBlbHNlIHsKICAgICAgZm9ybURhdGEudmFsdWUgPSB7CiAgICAgICAgZGF0ZU1vZGFsOiBmYWxzZSwKICAgICAgICBjdXN0b21lcl9uYW1lOiBudWxsLAogICAgICAgIGN1c3RvbWVyX2lkOiBudWxsLAogICAgICAgIGRhdGVfcG9zdGVkOiBudWxsLAogICAgICAgIGNvbGxlY3Rpb25fb3JkZXJfbnVtYmVyOiBudWxsLAogICAgICAgIGRvY3VtZW50X2lkOiBudWxsLAogICAgICAgIGFkZHJlc3M6IG51bGwsCiAgICAgICAgcmVtYXJrczogbnVsbCwKICAgICAgICBhcmVhOiBudWxsLAogICAgICAgIHNhbGVzbWFuX2lkXzE6IG51bGwsCiAgICAgICAgc2FsZXNtYW5faWRfMjogbnVsbCwKICAgICAgICB0ZXJtX2lkOiBudWxsLAogICAgICAgIHZhdF9pZDogbnVsbAogICAgICB9OwogICAgfQoKICAgIGlmICgoKF9mb3JtRGF0YSR2YWx1ZSRzYWxlczIgPSBmb3JtRGF0YS52YWx1ZS5zYWxlc19kcl9wYXltZW50cykgPT09IG51bGwgfHwgX2Zvcm1EYXRhJHZhbHVlJHNhbGVzMiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Zvcm1EYXRhJHZhbHVlJHNhbGVzMi5sZW5ndGgpID4gMCkgewogICAgICBzYWxlc0RyTGlzdC52YWx1ZSA9IFtdOwogICAgICBzYWxlc0RyTGlzdC52YWx1ZSA9IGZvcm1EYXRhLnZhbHVlLnNhbGVzX2RyX3BheW1lbnRzLm1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIGl0ZW0uaWQgPSBpdGVtLnNhbGVzX2RyLmlkOwogICAgICAgIGl0ZW0uc2FsZXNfZHJfbnVtYmVyID0gaXRlbS5zYWxlc19kci5zYWxlc19kcl9udW1iZXI7CiAgICAgICAgaXRlbS5yZW1haW5pbmdfYmFsYW5jZSA9IHBhcnNlRmxvYXQoaXRlbS5zYWxlc19kci5yZW1haW5pbmdfYmFsYW5jZSk7CiAgICAgICAgcmV0dXJuIGl0ZW07CiAgICAgIH0pOwogICAgfQoKICAgIG9uVW5tb3VudGVkKCAvKiNfX1BVUkVfXyovX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgcGF5bWVudFdhcm5pbmcudmFsdWUgPSBmYWxzZTsKICAgICAgICAgICAgICBzYWxlc0RyTGlzdC52YWx1ZSA9IFtdOwogICAgICAgICAgICAgIGZvcm1EYXRhLnZhbHVlID0gewogICAgICAgICAgICAgICAgZGF0ZU1vZGFsOiBmYWxzZSwKICAgICAgICAgICAgICAgIGN1c3RvbWVyX25hbWU6IG51bGwsCiAgICAgICAgICAgICAgICBjdXN0b21lcl9pZDogbnVsbCwKICAgICAgICAgICAgICAgIGRhdGVfcG9zdGVkOiBudWxsLAogICAgICAgICAgICAgICAgY29sbGVjdGlvbl9vcmRlcl9udW1iZXI6IG51bGwsCiAgICAgICAgICAgICAgICBkb2N1bWVudF9pZDogbnVsbCwKICAgICAgICAgICAgICAgIGFkZHJlc3M6IG51bGwsCiAgICAgICAgICAgICAgICByZW1hcmtzOiBudWxsLAogICAgICAgICAgICAgICAgYXJlYTogbnVsbCwKICAgICAgICAgICAgICAgIHNhbGVzbWFuX2lkXzE6IG51bGwsCiAgICAgICAgICAgICAgICBzYWxlc21hbl9pZF8yOiBudWxsLAogICAgICAgICAgICAgICAgdGVybV9pZDogbnVsbCwKICAgICAgICAgICAgICAgIHZhdF9pZDogbnVsbAogICAgICAgICAgICAgIH07CgogICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWUpOwogICAgfSkpKTsKICAgIHdhdGNoKGRhdGFQcm9wLCBmdW5jdGlvbiAoKSB7CiAgICAgIGlmIChtb2RlRGF0YS52YWx1ZSA9PT0gJ0VkaXQnKSB7CiAgICAgICAgdmFyIF9mb3JtRGF0YSR2YWx1ZSRzYWxlczM7CgogICAgICAgIGZvcm1EYXRhLnZhbHVlID0gZGF0YVByb3AudmFsdWU7CiAgICAgICAgZm9ybURhdGEudmFsdWUuY3VzdG9tZXJfbmFtZSA9IGRhdGFQcm9wLnZhbHVlLmN1c3RvbWVyLm5hbWU7CiAgICAgICAgZm9ybURhdGEudmFsdWUuY3VzdG9tZXJfaWQgPSBkYXRhUHJvcC52YWx1ZS5jdXN0b21lci5pZDsKICAgICAgICBmb3JtRGF0YS52YWx1ZS50eXBlID0gZGF0YVByb3AudmFsdWUuY3VzdG9tZXIudHlwZTsKCiAgICAgICAgaWYgKCgoX2Zvcm1EYXRhJHZhbHVlJHNhbGVzMyA9IGZvcm1EYXRhLnZhbHVlLnNhbGVzX2RyX3BheW1lbnRzKSA9PT0gbnVsbCB8fCBfZm9ybURhdGEkdmFsdWUkc2FsZXMzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZm9ybURhdGEkdmFsdWUkc2FsZXMzLmxlbmd0aCkgPiAwKSB7CiAgICAgICAgICBzYWxlc0RyTGlzdC52YWx1ZSA9IFtdOwogICAgICAgICAgc2FsZXNEckxpc3QudmFsdWUgPSBmb3JtRGF0YS52YWx1ZS5zYWxlc19kcl9wYXltZW50cy5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgaXRlbS5zYWxlc19kcl9udW1iZXIgPSBpdGVtLnNhbGVzX2RyLnNhbGVzX2RyX251bWJlcjsKICAgICAgICAgICAgaXRlbS5yZW1haW5pbmdfYmFsYW5jZSA9IHBhcnNlRmxvYXQoaXRlbS5zYWxlc19kci5yZW1haW5pbmdfYmFsYW5jZSk7CiAgICAgICAgICAgIHJldHVybiBpdGVtOwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBwYXltZW50c1JlaW5pdGlhbGl6ZSgpOwogICAgICAgIHN0b3JlLmRpc3BhdGNoKCdTYWxlc0RyU3RvcmUvZHJMaXN0QnlDdXN0b21lcicsIGZvcm1EYXRhLnZhbHVlLmN1c3RvbWVyLmlkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBmb3JtRGF0YS52YWx1ZSA9IHsKICAgICAgICAgIGRhdGVNb2RhbDogZmFsc2UsCiAgICAgICAgICBjdXN0b21lcl9uYW1lOiBudWxsLAogICAgICAgICAgY3VzdG9tZXJfaWQ6IG51bGwsCiAgICAgICAgICBkYXRlX3Bvc3RlZDogbnVsbCwKICAgICAgICAgIGNvbGxlY3Rpb25fb3JkZXJfbnVtYmVyOiBudWxsLAogICAgICAgICAgZG9jdW1lbnRfaWQ6IG51bGwsCiAgICAgICAgICBhZGRyZXNzOiBudWxsLAogICAgICAgICAgcmVtYXJrczogbnVsbCwKICAgICAgICAgIGFyZWE6IG51bGwsCiAgICAgICAgICBzYWxlc21hbl9pZF8xOiBudWxsLAogICAgICAgICAgc2FsZXNtYW5faWRfMjogbnVsbCwKICAgICAgICAgIHRlcm1faWQ6IG51bGwsCiAgICAgICAgICB2YXRfaWQ6IG51bGwKICAgICAgICB9OwogICAgICAgIHNhbGVzRHJMaXN0LnZhbHVlID0gW107CiAgICAgIH0KICAgIH0pOwoKICAgIHZhciBjYW5jZWwgPSBmdW5jdGlvbiBjYW5jZWwoKSB7CiAgICAgIGVtaXQoJ3N1Ym1pdCcpOwogICAgfTsKCiAgICB2YXIgdG90YWxQYXltZW50QW1vdW50ID0gcmVmKDApOwoKICAgIHZhciBzaG93Q3VzdG9tZXJNb2RhbCA9IGZ1bmN0aW9uIHNob3dDdXN0b21lck1vZGFsKCkgewogICAgICBjdXN0b21lck1vZGFsLnZhbHVlID0gdHJ1ZTsKICAgIH07CgogICAgdmFyIG9uU2VsZWN0Q3VzdG9tZXIgPSBmdW5jdGlvbiBvblNlbGVjdEN1c3RvbWVyKGN1c3RvbWVyKSB7CiAgICAgIGlmIChjdXN0b21lciAhPT0gbnVsbCAmJiBjdXN0b21lciAhPT0gdm9pZCAwICYmIGN1c3RvbWVyLmlkKSB7CiAgICAgICAgZm9ybURhdGEudmFsdWUuY3VzdG9tZXJfbmFtZSA9IGN1c3RvbWVyLm5hbWU7CiAgICAgICAgZm9ybURhdGEudmFsdWUuY3VzdG9tZXJfaWQgPSBjdXN0b21lci5pZDsKICAgICAgICBmb3JtRGF0YS52YWx1ZS5kb2N1bWVudF9pZCA9IGN1c3RvbWVyLmRvY3VtZW50X2lkOwogICAgICAgIGZvcm1EYXRhLnZhbHVlLmFkZHJlc3MgPSBjdXN0b21lci5hZGRyZXNzOwogICAgICAgIGZvcm1EYXRhLnZhbHVlLnJlbWFya3MgPSBjdXN0b21lci5yZW1hcmtzOwogICAgICAgIGZvcm1EYXRhLnZhbHVlLmFyZWEgPSBjdXN0b21lci5hcmVhOwogICAgICAgIGZvcm1EYXRhLnZhbHVlLnNhbGVzbWFuX2lkXzEgPSBjdXN0b21lci5zYWxlc21hbl9pZF8xOwogICAgICAgIGZvcm1EYXRhLnZhbHVlLnNhbGVzbWFuX2lkXzIgPSBjdXN0b21lci5zYWxlc21hbl9pZF8yOwogICAgICAgIGZvcm1EYXRhLnZhbHVlLnRlcm1faWQgPSBjdXN0b21lci50ZXJtX2lkOwogICAgICAgIGZvcm1EYXRhLnZhbHVlLnZhdF9pZCA9IGN1c3RvbWVyLnZhdF9pZDsKICAgICAgICBmb3JtRGF0YS52YWx1ZS50eXBlID0gY3VzdG9tZXIudHlwZTsKICAgICAgICBzdG9yZS5kaXNwYXRjaCgnU2FsZXNEclN0b3JlL2RyTGlzdEJ5Q3VzdG9tZXInLCBjdXN0b21lci5pZCk7CiAgICAgIH0KCiAgICAgIGN1c3RvbWVyTW9kYWwudmFsdWUgPSBmYWxzZTsKICAgIH07CgogICAgdmFyIHRvZ2dsZURyTW9kYWwgPSBmdW5jdGlvbiB0b2dnbGVEck1vZGFsKCkgewogICAgICBkckxpc3RNb2RhbC52YWx1ZSA9ICFkckxpc3RNb2RhbC52YWx1ZTsKICAgIH07CgogICAgdmFyIHRvZ2dsZVBheW1lbnRNb2RhbCA9IGZ1bmN0aW9uIHRvZ2dsZVBheW1lbnRNb2RhbCgpIHsKICAgICAgcGF5bWVudE1vZGFsLnZhbHVlID0gIXBheW1lbnRNb2RhbC52YWx1ZTsKICAgIH07CgogICAgdmFyIHNlbGVjdGVkRHJzID0gZnVuY3Rpb24gc2VsZWN0ZWREcnMoc2FsZXNEcnMpIHsKICAgICAgc2FsZXNEckxpc3QudmFsdWUgPSBbXTsKICAgICAgc2FsZXNEcnMuZm9yRWFjaChmdW5jdGlvbiAoZWxlbWVudCkgewogICAgICAgIHZhciBfZWxlbWVudCRhcmVhLCBfZWxlbWVudCR0ZXJtX2lkLCBfZWxlbWVudCRhZGRyZXNzLCBfZWxlbWVudCRyZW1hcmtzLCBfZWxlbWVudCRzYWxlc21hbl9pZF8sIF9lbGVtZW50JHNhbGVzbWFuX2lkXzIsIF9lbGVtZW50JHZhdF9pZCwgX2VsZW1lbnQkcHJvbW9fY29kZTsKCiAgICAgICAgZWxlbWVudC5yZW1haW5pbmdfYmFsYW5jZSA9IHBhcnNlRmxvYXQoZWxlbWVudC5yZW1haW5pbmdfYmFsYW5jZSk7CiAgICAgICAgZWxlbWVudC5hbW91bnRfdG9fcGF5ID0gMDsKICAgICAgICBjb25zb2xlLmxvZyhlbGVtZW50KTsKICAgICAgICBmb3JtRGF0YS52YWx1ZS5hcmVhID0gKF9lbGVtZW50JGFyZWEgPSBlbGVtZW50LmFyZWEpICE9PSBudWxsICYmIF9lbGVtZW50JGFyZWEgIT09IHZvaWQgMCA/IF9lbGVtZW50JGFyZWEgOiBmb3JtRGF0YS52YWx1ZS5hcmVhOwogICAgICAgIGZvcm1EYXRhLnZhbHVlLnRlcm1faWQgPSAoX2VsZW1lbnQkdGVybV9pZCA9IGVsZW1lbnQudGVybV9pZCkgIT09IG51bGwgJiYgX2VsZW1lbnQkdGVybV9pZCAhPT0gdm9pZCAwID8gX2VsZW1lbnQkdGVybV9pZCA6IGZvcm1EYXRhLnZhbHVlLnRlcm1faWQ7CiAgICAgICAgZm9ybURhdGEudmFsdWUuYWRkcmVzcyA9IChfZWxlbWVudCRhZGRyZXNzID0gZWxlbWVudC5hZGRyZXNzKSAhPT0gbnVsbCAmJiBfZWxlbWVudCRhZGRyZXNzICE9PSB2b2lkIDAgPyBfZWxlbWVudCRhZGRyZXNzIDogZm9ybURhdGEudmFsdWUuYWRkcmVzczsKICAgICAgICBmb3JtRGF0YS52YWx1ZS5yZW1hcmtzID0gKF9lbGVtZW50JHJlbWFya3MgPSBlbGVtZW50LnJlbWFya3MpICE9PSBudWxsICYmIF9lbGVtZW50JHJlbWFya3MgIT09IHZvaWQgMCA/IF9lbGVtZW50JHJlbWFya3MgOiBmb3JtRGF0YS52YWx1ZS5yZW1hcmtzOwogICAgICAgIGZvcm1EYXRhLnZhbHVlLnNhbGVzbWFuX2lkXzEgPSAoX2VsZW1lbnQkc2FsZXNtYW5faWRfID0gZWxlbWVudC5zYWxlc21hbl9pZF8xKSAhPT0gbnVsbCAmJiBfZWxlbWVudCRzYWxlc21hbl9pZF8gIT09IHZvaWQgMCA/IF9lbGVtZW50JHNhbGVzbWFuX2lkXyA6IGZvcm1EYXRhLnZhbHVlLnNhbGVzbWFuX2lkXzE7CiAgICAgICAgZm9ybURhdGEudmFsdWUuc2FsZXNtYW5faWRfMiA9IChfZWxlbWVudCRzYWxlc21hbl9pZF8yID0gZWxlbWVudC5zYWxlc21hbl9pZF8yKSAhPT0gbnVsbCAmJiBfZWxlbWVudCRzYWxlc21hbl9pZF8yICE9PSB2b2lkIDAgPyBfZWxlbWVudCRzYWxlc21hbl9pZF8yIDogZm9ybURhdGEudmFsdWUuc2FsZXNtYW5faWRfMjsKICAgICAgICBmb3JtRGF0YS52YWx1ZS52YXRfaWQgPSAoX2VsZW1lbnQkdmF0X2lkID0gZWxlbWVudC52YXRfaWQpICE9PSBudWxsICYmIF9lbGVtZW50JHZhdF9pZCAhPT0gdm9pZCAwID8gX2VsZW1lbnQkdmF0X2lkIDogZm9ybURhdGEudmFsdWUudmF0X2lkOwogICAgICAgIGZvcm1EYXRhLnZhbHVlLnByb21vX2NvZGUgPSAoX2VsZW1lbnQkcHJvbW9fY29kZSA9IGVsZW1lbnQucHJvbW9fY29kZSkgIT09IG51bGwgJiYgX2VsZW1lbnQkcHJvbW9fY29kZSAhPT0gdm9pZCAwID8gX2VsZW1lbnQkcHJvbW9fY29kZSA6IGZvcm1EYXRhLnZhbHVlLnByb21vX2NvZGU7CiAgICAgICAgc2FsZXNEckxpc3QudmFsdWUucHVzaChlbGVtZW50KTsKICAgICAgfSk7CiAgICAgIHRvZ2dsZURyTW9kYWwoKTsKICAgIH07CgogICAgdmFyIHJlbW92ZURyID0gZnVuY3Rpb24gcmVtb3ZlRHIoaXRlbSkgewogICAgICB2YXIgaW5kZXggPSBzYWxlc0RyTGlzdC52YWx1ZS5maW5kKGZ1bmN0aW9uIChkcikgewogICAgICAgIHJldHVybiBkci5pZCA9PT0gaXRlbS5pZDsKICAgICAgfSk7CiAgICAgIHNhbGVzRHJMaXN0LnZhbHVlLnNwbGljZShpbmRleCwgMSk7CiAgICB9OwoKICAgIHZhciByZW1vdmVQYXltZW50ID0gZnVuY3Rpb24gcmVtb3ZlUGF5bWVudChpdGVtLCBpbmRleCkgewogICAgICBwYXltZW50cy52YWx1ZS5zcGxpY2UoaW5kZXgsIDEpOwogICAgfTsKCiAgICB2YXIgc3VibWl0ID0gZnVuY3Rpb24gc3VibWl0KCkgewogICAgICBwYXltZW50cy52YWx1ZS5mb3JFYWNoKGZ1bmN0aW9uIChwYXltZW50LCBpbmRleCkgewogICAgICAgIGlmIChwYXltZW50LnBheW1lbnRfdHlwZSA9PT0gJ0Nhc2ggUGF5bWVudCcpIHsKICAgICAgICAgIHBheW1lbnRzLnZhbHVlW2luZGV4XS50eXBlID0gJ2Nhc2hfcGF5bWVudCc7CiAgICAgICAgfQoKICAgICAgICBpZiAocGF5bWVudC5wYXltZW50X3R5cGUgPT09ICdDaGVjayBQYXltZW50JykgewogICAgICAgICAgcGF5bWVudHMudmFsdWVbaW5kZXhdLnR5cGUgPSAnY2hlY2tfcGF5bWVudCc7CiAgICAgICAgfQoKICAgICAgICBpZiAocGF5bWVudC5wYXltZW50X3R5cGUgPT09ICdPbmxpbmUgUGF5bWVudCcpIHsKICAgICAgICAgIHBheW1lbnRzLnZhbHVlW2luZGV4XS50eXBlID0gJ29ubGluZV9wYXltZW50JzsKICAgICAgICB9CgogICAgICAgIHRvdGFsUGF5bWVudEFtb3VudC52YWx1ZSA9IHBhcnNlRmxvYXQodG90YWxQYXltZW50QW1vdW50LnZhbHVlKSAtIHBhcnNlRmxvYXQocGF5bWVudC5hbW91bnQpOwogICAgICB9KTsKCiAgICAgIGlmICh0b3RhbFBheW1lbnRBbW91bnQudmFsdWUgPiAwKSB7CiAgICAgICAgcGF5bWVudFdhcm5pbmcudmFsdWUgPSB0cnVlOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgcGF5bWVudFdhcm5pbmcudmFsdWUgPSBmYWxzZTsKCiAgICAgIGlmIChtb2RlRGF0YS52YWx1ZSA9PT0gJ0NyZWF0ZScpIHsKICAgICAgICB2YXIgcGF5bG9hZCA9IGZvcm1EYXRhLnZhbHVlOwogICAgICAgIHBheWxvYWQuYW1vdW50ID0gdG90YWxBbW91bnQudmFsdWU7CiAgICAgICAgcGF5bG9hZC5kYXRlX3Bvc3RlZCA9IGRhdGVQb3N0ZWQudmFsdWU7CiAgICAgICAgcGF5bG9hZC5wYXltZW50X2l0ZW1zID0gcGF5bWVudHMudmFsdWU7CiAgICAgICAgcGF5bG9hZC5kcl9pdGVtcyA9IHNhbGVzRHJMaXN0LnZhbHVlOwogICAgICAgIHN0b3JlLmRpc3BhdGNoKCdDb2xsZWN0aW9uU3RvcmUvY3JlYXRlJywgcGF5bG9hZCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBlbWl0KCdzdWJtaXQnLCByZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgX3BheWxvYWQgPSBmb3JtRGF0YS52YWx1ZTsKICAgICAgICBfcGF5bG9hZC5hbW91bnQgPSB0b3RhbEFtb3VudC52YWx1ZTsKICAgICAgICBfcGF5bG9hZC5kYXRlX3Bvc3RlZCA9IGRhdGVQb3N0ZWQudmFsdWU7CiAgICAgICAgX3BheWxvYWQucGF5bWVudF9pdGVtcyA9IHBheW1lbnRzLnZhbHVlOwogICAgICAgIF9wYXlsb2FkLmRyX2l0ZW1zID0gc2FsZXNEckxpc3QudmFsdWU7CiAgICAgICAgc3RvcmUuZGlzcGF0Y2goJ0NvbGxlY3Rpb25TdG9yZS91cGRhdGUnLCBfcGF5bG9hZCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBlbWl0KCdzdWJtaXQnLCByZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfTsKCiAgICB3YXRjaChwYXltZW50cywgZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgIHZhciBfdG90YWxBbW91bnQkdmFsdWU7CgogICAgICB0b3RhbFBheW1lbnRBbW91bnQudmFsdWUgPSAoX3RvdGFsQW1vdW50JHZhbHVlID0gdG90YWxBbW91bnQudmFsdWUpICE9PSBudWxsICYmIF90b3RhbEFtb3VudCR2YWx1ZSAhPT0gdm9pZCAwID8gX3RvdGFsQW1vdW50JHZhbHVlIDogMDsKICAgICAgdmFsdWUuZm9yRWFjaChmdW5jdGlvbiAocGF5bWVudCkgewogICAgICAgIHRvdGFsUGF5bWVudEFtb3VudC52YWx1ZSA9IHBhcnNlRmxvYXQodG90YWxQYXltZW50QW1vdW50LnZhbHVlKSAtIHBhcnNlRmxvYXQocGF5bWVudC5hbW91bnQpOwogICAgICB9KTsKICAgIH0pOwoKICAgIHZhciBwb3N0T3JkZXIgPSBmdW5jdGlvbiBwb3N0T3JkZXIoKSB7CiAgICAgIHN0b3JlLmRpc3BhdGNoKCdDb2xsZWN0aW9uU3RvcmUvcG9zdE9yZGVyJywgZm9ybURhdGEudmFsdWUuaWQpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBlbWl0KCdzdWJtaXQnLCByZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfTsKCiAgICB2YXIgdW5wb3N0T3JkZXIgPSBmdW5jdGlvbiB1bnBvc3RPcmRlcigpIHsKICAgICAgc3RvcmUuZGlzcGF0Y2goJ0NvbGxlY3Rpb25TdG9yZS91bnBvc3RPcmRlcicsIGZvcm1EYXRhLnZhbHVlLmlkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgZW1pdCgnc3VibWl0JywgcmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH07CgogICAgdmFyIGFkZGVkUGF5bWVudCA9IGZ1bmN0aW9uIGFkZGVkUGF5bWVudChwYXltZW50KSB7CiAgICAgIHRvZ2dsZVBheW1lbnRNb2RhbCgpOwogICAgICBwYXltZW50cy52YWx1ZS5wdXNoKHBheW1lbnQpOwogICAgfTsKCiAgICB2YXIgdG90YWxQYXltZW50Q2hlY2sgPSBmdW5jdGlvbiB0b3RhbFBheW1lbnRDaGVjayhhbW91bnQpIHsKICAgICAgdG90YWxBbW91bnQudmFsdWUgPSBhbW91bnQ7CiAgICAgIHRvdGFsUGF5bWVudEFtb3VudC52YWx1ZSA9IGFtb3VudDsKICAgIH07CgogICAgdmFyIG9uSW5pdCA9IGZ1bmN0aW9uIG9uSW5pdChwcm9taXNlKSB7CiAgICAgIHByb21pc2UudGhlbihjb25zb2xlLmxvZykuY2F0Y2goY29uc29sZS5lcnJvcik7CiAgICB9OwoKICAgIHZhciBvbkRlY29kZSA9IGZ1bmN0aW9uIG9uRGVjb2RlKGlkKSB7CiAgICAgIHN0b3JlLmRpc3BhdGNoKCdTYWxlc0RyU3RvcmUvZ2V0JywgaWQpOwogICAgICBjb25zb2xlLmxvZyhpZCk7CiAgICB9OwoKICAgIHZhciBzY2FubmVyT3B0aW9ucyA9IGZ1bmN0aW9uIHNjYW5uZXJPcHRpb25zKGRldGVjdGVkQ29kZXMsIGN0eCkgewogICAgICB2YXIgX2l0ZXJhdG9yID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoZGV0ZWN0ZWRDb2RlcyksCiAgICAgICAgICBfc3RlcDsKCiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3IucygpOyAhKF9zdGVwID0gX2l0ZXJhdG9yLm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBkZXRlY3RlZENvZGUgPSBfc3RlcC52YWx1ZTsKCiAgICAgICAgICB2YXIgX2RldGVjdGVkQ29kZSRjb3JuZXJQID0gX3RvQXJyYXkoZGV0ZWN0ZWRDb2RlLmNvcm5lclBvaW50cyksCiAgICAgICAgICAgICAgZmlyc3RQb2ludCA9IF9kZXRlY3RlZENvZGUkY29ybmVyUFswXSwKICAgICAgICAgICAgICBvdGhlclBvaW50cyA9IF9kZXRlY3RlZENvZGUkY29ybmVyUC5zbGljZSgxKTsKCiAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAncmVkJzsKICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgIGN0eC5tb3ZlVG8oZmlyc3RQb2ludC54LCBmaXJzdFBvaW50LnkpOwoKICAgICAgICAgIHZhciBfaXRlcmF0b3IyID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIob3RoZXJQb2ludHMpLAogICAgICAgICAgICAgIF9zdGVwMjsKCiAgICAgICAgICB0cnkgewogICAgICAgICAgICBmb3IgKF9pdGVyYXRvcjIucygpOyAhKF9zdGVwMiA9IF9pdGVyYXRvcjIubigpKS5kb25lOykgewogICAgICAgICAgICAgIHZhciBfc3RlcDIkdmFsdWUgPSBfc3RlcDIudmFsdWUsCiAgICAgICAgICAgICAgICAgIHggPSBfc3RlcDIkdmFsdWUueCwKICAgICAgICAgICAgICAgICAgeSA9IF9zdGVwMiR2YWx1ZS55OwogICAgICAgICAgICAgIGN0eC5saW5lVG8oeCwgeSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBfaXRlcmF0b3IyLmUoZXJyKTsKICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9pdGVyYXRvcjIuZigpOwogICAgICAgICAgfQoKICAgICAgICAgIGN0eC5saW5lVG8oZmlyc3RQb2ludC54LCBmaXJzdFBvaW50LnkpOwogICAgICAgICAgY3R4LmNsb3NlUGF0aCgpOwogICAgICAgICAgY3R4LnN0cm9rZSgpOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2l0ZXJhdG9yLmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3IuZigpOwogICAgICB9CiAgICB9OwoKICAgIHJldHVybiB7CiAgICAgIHRvdGFsUGF5bWVudEFtb3VudDogdG90YWxQYXltZW50QW1vdW50LAogICAgICBwYXltZW50V2FybmluZzogcGF5bWVudFdhcm5pbmcsCiAgICAgIHRvdGFsUGF5bWVudENoZWNrOiB0b3RhbFBheW1lbnRDaGVjaywKICAgICAgcG9zdE9yZGVyOiBwb3N0T3JkZXIsCiAgICAgIHVucG9zdE9yZGVyOiB1bnBvc3RPcmRlciwKICAgICAgcmVtb3ZlUGF5bWVudDogcmVtb3ZlUGF5bWVudCwKICAgICAgYWRkZWRQYXltZW50OiBhZGRlZFBheW1lbnQsCiAgICAgIHRvdGFsQW1vdW50OiB0b3RhbEFtb3VudCwKICAgICAgdG9nZ2xlUGF5bWVudE1vZGFsOiB0b2dnbGVQYXltZW50TW9kYWwsCiAgICAgIHBheW1lbnRzOiBwYXltZW50cywKICAgICAgcGF5bWVudE1vZGFsOiBwYXltZW50TW9kYWwsCiAgICAgIHJlbW92ZURyOiByZW1vdmVEciwKICAgICAgc2FsZXNEckxpc3Q6IHNhbGVzRHJMaXN0LAogICAgICBkckxpc3RNb2RhbDogZHJMaXN0TW9kYWwsCiAgICAgIHNlbGVjdGVkRHJzOiBzZWxlY3RlZERycywKICAgICAgdG9nZ2xlRHJNb2RhbDogdG9nZ2xlRHJNb2RhbCwKICAgICAgc3VibWl0OiBzdWJtaXQsCiAgICAgIGNhbmNlbDogY2FuY2VsLAogICAgICBlcnJvcnM6IGNvbXB1dGVkKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gc3RvcmUuc3RhdGUuQ29sbGVjdGlvblN0b3JlLmVycm9yczsKICAgICAgfSksCiAgICAgIGZvcm1EYXRhOiBmb3JtRGF0YSwKICAgICAgaWNvbnM6IHsKICAgICAgICBtZGlJbmZvcm1hdGlvbjogbWRpSW5mb3JtYXRpb24sCiAgICAgICAgbWRpQWNjb3VudFBsdXNPdXRsaW5lOiBtZGlBY2NvdW50UGx1c091dGxpbmUsCiAgICAgICAgbWRpQ2FyZE9mZjogbWRpQ2FyZE9mZiwKICAgICAgICBtZGlDdXJyZW5jeVNpZ246IG1kaUN1cnJlbmN5U2lnbgogICAgICB9LAogICAgICBzaG93Q3VzdG9tZXJNb2RhbDogc2hvd0N1c3RvbWVyTW9kYWwsCiAgICAgIGRhdGVQb3N0ZWQ6IGRhdGVQb3N0ZWQsCiAgICAgIGN1c3RvbWVyTW9kYWw6IGN1c3RvbWVyTW9kYWwsCiAgICAgIG9uU2VsZWN0Q3VzdG9tZXI6IG9uU2VsZWN0Q3VzdG9tZXIsCiAgICAgIHNhbGVzbWFuczogY29tcHV0ZWQoZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBzdG9yZS5zdGF0ZS5TYWxlc21hblN0b3JlLnNhbGVzbWFuczsKICAgICAgfSksCiAgICAgIHRlcm1zOiBjb21wdXRlZChmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHN0b3JlLnN0YXRlLlRlcm1TdG9yZS50ZXJtczsKICAgICAgfSksCiAgICAgIHZhdHM6IGNvbXB1dGVkKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gc3RvcmUuc3RhdGUuVmF0U3RvcmUudmF0czsKICAgICAgfSksCiAgICAgIGRvY3VtZW50czogY29tcHV0ZWQoZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBzdG9yZS5zdGF0ZS5Eb2N1bWVudFN0b3JlLmRvY3VtZW50cy5maWx0ZXIoZnVuY3Rpb24gKGRvY3VtZW50SXRlbSkgewogICAgICAgICAgaWYgKGRvY3VtZW50SXRlbS5tb2R1bGUgPT09ICdDb2xsZWN0aW9uJykgewogICAgICAgICAgICBkb2N1bWVudEl0ZW0udGl0bGUgPSAiIi5jb25jYXQoZG9jdW1lbnRJdGVtLmRvY3VtZW50X25hbWUpOwogICAgICAgICAgICByZXR1cm4gZG9jdW1lbnRJdGVtOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9KSwKICAgICAgdHlwZXM6IHJlZihbJ1JlZ3VsYXInLCAnRGlzdHJpYnV0b3InXSksCiAgICAgIG9uSW5pdDogb25Jbml0LAogICAgICBvbkRlY29kZTogb25EZWNvZGUsCiAgICAgIHNjYW5uZXJPcHRpb25zOiBzY2FubmVyT3B0aW9ucywKICAgICAgc2hvd1NjYW5uZXI6IHNob3dTY2FubmVyCiAgICB9OwogIH0KfTs="},{"version":3,"mappings":"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","names":["computed","onUnmounted","ref","toRef","watch","mdiAccountPlusOutline","mdiCardOff","mdiCurrencySign","mdiInformation","name","components","CustomerForm","SalesDrTable","CollectionPayment","DrListSelection","PaymentForm","QrcodeStream","props","mode","type","required","default","data","setup","store","dateModal","customer_name","customer_id","date_posted","collection_order_number","document_id","address","remarks","area","salesman_id_1","salesman_id_2","term_id","vat_id","payments","payment","formData","salesDrList","item","paymentsReinitialize","paymentWarning","emit","customerModal","drListModal","paymentModal","salesDrs","element","console","toggleDrModal","totalPaymentAmount","payload","value","togglePaymentModal","totalAmount","promise","then","catch","detectedCodes","ctx","otherPoints","totalPaymentCheck","postOrder","unpostOrder","removePayment","addedPayment","removeDr","selectedDrs","submit","cancel","errors","icons","showCustomerModal","datePosted","onSelectCustomer","salesmans","terms","vats","documents","documentItem","types","onInit","onDecode","scannerOptions","showScanner"],"sourceRoot":"src/views/pages/sales/collections","sources":["CollectionForm.vue"],"sourcesContent":["<template>\n  <v-card>\n    <v-card-title class=\"pa-6\">\n      {{ mode }} Collection\n    </v-card-title>\n    <v-card-text>\n      <v-form>\n        <v-row>\n          <v-col cols=\"12\">\n            <v-alert\n              color=\"primary\"\n              text\n              style=\"margin-bottom: -10px\"\n            >\n              <div class=\"d-flex align-start\">\n                <v-icon color=\"primary\">\n                  {{ icons.mdiInformation }}\n                </v-icon>\n                <div class=\"ms-3\">\n                  <p class=\"text-base font-weight-medium mb-1\">\n                    Information\n                  </p>\n                </div>\n              </div>\n            </v-alert>\n          </v-col>\n          <v-col\n            cols=\"6\"\n            class=\"pr-8 pl-8\"\n          >\n            <v-menu\n              v-model=\"formData.dateModal\"\n              :close-on-content-click=\"false\"\n              transition=\"scale-transition\"\n              offset-y\n              :disabled=\"formData.status === 'Posted'\"\n              max-width=\"290px\"\n              min-width=\"auto\"\n            >\n              <template v-slot:activator=\"{ on, attrs }\">\n                <v-text-field\n                  v-model=\"datePosted\"\n                  label=\"Date\"\n                  persistent-hint\n                  :prepend-icon=\"icons.mdiCalendar\"\n                  readonly\n                  v-bind=\"attrs\"\n                  v-on=\"on\"\n                ></v-text-field>\n              </template>\n\n              <v-date-picker\n                v-model=\"datePosted\"\n                no-title\n                color=\"primary\"\n                @input=\"formData.dateModal = false\"\n              ></v-date-picker>\n            </v-menu>\n          </v-col>\n          <v-col\n            cols=\"3\"\n            class=\"pr-8 pl-8\"\n          >\n            <v-text-field\n              v-model=\"formData.collection_order_number\"\n              outlined\n              :disabled=\"formData.id !== undefined\"\n              :error-messages=\"errors.collection_order_number\"\n              dense\n              hide-details=\"auto\"\n              label=\"Collection Number\"\n            ></v-text-field>\n          </v-col>\n          <v-col\n            cols=\"3\"\n            class=\"pr-8 pl-8\"\n          >\n            <v-select\n              v-model=\"formData.document_id\"\n              :items=\"documents\"\n              item-text=\"title\"\n              item-value=\"id\"\n              label=\"Document\"\n              :disabled=\"formData.status === 'Posted'\"\n              :error-messages=\"errors.document_id\"\n              outlined\n              dense\n              hide-details=\"auto\"\n            ></v-select>\n          </v-col>\n          <v-col\n            cols=\"4\"\n            class=\"pl-8\"\n          >\n            <v-text-field\n              v-model=\"formData.customer_name\"\n              outlined\n              readonly\n              :error-messages=\"errors.customer_id\"\n              dense\n              hide-details=\"auto\"\n              label=\"Customer\"\n            ></v-text-field>\n          </v-col>\n          <v-col\n            cols=\"2\"\n          >\n            <v-btn\n              v-if=\"mode == 'Create'\"\n              class=\"md4\"\n              color=\"primary\"\n              x-small\n              dark\n              @click=\"showCustomerModal\"\n            >\n              Get Customer\n              <v-icon>\n                {{ icons.mdiAccountPlusOutline }}\n              </v-icon>\n            </v-btn>\n          </v-col>\n          <v-col\n            cols=\"3\"\n            class=\"pr-8 pl-8\"\n          >\n            <v-select\n              v-model=\"formData.type\"\n              :items=\"types\"\n              label=\"Customer Type\"\n              disabled\n              :error-messages=\"errors.type\"\n              readonly\n              outlined\n              dense\n              hide-details=\"auto\"\n            ></v-select>\n          </v-col>\n          <v-col\n            cols=\"3\"\n            class=\"pr-8 pl-8\"\n          >\n            <v-text-field\n              v-model=\"formData.area\"\n              outlined\n              dense\n              :disabled=\"formData.status === 'Posted'\"\n              :error-messages=\"errors.area\"\n              hide-details=\"auto\"\n              label=\"Area\"\n            ></v-text-field>\n          </v-col>\n          <v-col\n            cols=\"3\"\n            class=\"pr-8 pl-8\"\n          >\n            <v-select\n              v-model=\"formData.term_id\"\n              :items=\"terms\"\n              :disabled=\"formData.status === 'Posted'\"\n              label=\"Term\"\n              item-text=\"code\"\n              item-value=\"id\"\n              :error-messages=\"errors.term_id\"\n              outlined\n              dense\n              hide-details=\"auto\"\n            ></v-select>\n          </v-col>\n          <v-col\n            cols=\"3\"\n            class=\"pr-8 pl-8\"\n          >\n            <v-select\n              v-model=\"formData.vat_id\"\n              :items=\"vats\"\n              item-text=\"code\"\n              item-value=\"id\"\n              :disabled=\"formData.status === 'Posted'\"\n              label=\"Vat\"\n              :error-messages=\"errors.vat_id\"\n              outlined\n              dense\n              hide-details=\"auto\"\n            ></v-select>\n          </v-col>\n          <v-col\n            cols=\"3\"\n            class=\"pr-8 pl-8\"\n          >\n            <v-select\n              v-model=\"formData.salesman_id_1\"\n              :items=\"salesmans\"\n              item-text=\"salesman_name\"\n              item-value=\"id\"\n              :disabled=\"formData.status === 'Posted'\"\n              label=\"Agent 1\"\n              :error-messages=\"errors.salesman_id_1\"\n              outlined\n              dense\n              hide-details=\"auto\"\n            ></v-select>\n          </v-col>\n          <v-col\n            cols=\"3\"\n            class=\"pr-8 pl-8\"\n          >\n            <v-select\n              v-model=\"formData.salesman_id_2\"\n              :items=\"salesmans\"\n              item-text=\"salesman_name\"\n              item-value=\"id\"\n              :disabled=\"formData.status === 'Posted'\"\n              label=\"Agent 2\"\n              :error-messages=\"errors.salesman_id_2\"\n              outlined\n              dense\n              hide-details=\"auto\"\n            ></v-select>\n          </v-col>\n          <v-col\n            cols=\"6\"\n            class=\"pr-8 pl-8\"\n          >\n            <v-textarea\n              v-model=\"formData.address\"\n              outlined\n              :disabled=\"formData.status === 'Posted'\"\n              rows=\"2\"\n              dense\n              :error-messages=\"errors.address\"\n              hide-details=\"auto\"\n              label=\"Address\"\n            ></v-textarea>\n          </v-col>\n          <v-col\n            cols=\"3\"\n            class=\"pr-8 pl-8\"\n          >\n            <v-textarea\n              v-model=\"formData.remarks\"\n              outlined\n              :disabled=\"formData.status === 'Posted'\"\n              rows=\"2\"\n              dense\n              :error-messages=\"errors.remarks\"\n              hide-details=\"auto\"\n              label=\"Remarks\"\n            ></v-textarea>\n          </v-col>\n          <v-col\n            cols=\"3\"\n            class=\"pr-8 pl-8\"\n          >\n            <v-text-field\n              v-model=\"formData.promo_code\"\n              outlined\n              :disabled=\"formData.status === 'Posted'\"\n              dense\n              :error-messages=\"errors.promo_code\"\n              hide-details=\"auto\"\n              label=\"Promo Code\"\n            ></v-text-field>\n          </v-col>\n        </v-row>\n        <v-row class=\"mt-10\">\n          <v-col cols=\"12\">\n            <v-alert\n              color=\"info\"\n              text\n              style=\"margin-bottom: -10px\"\n            >\n              <div class=\"d-flex align-start\">\n                <v-icon color=\"info\">\n                  {{ icons.mdiCardOff }}\n                </v-icon>\n                <div class=\"ms-3\">\n                  <p class=\"text-base font-weight-medium mb-1\">\n                    Sales DR\n                  </p>\n                </div>\n              </div>\n            </v-alert>\n          </v-col>\n          <v-row\n            justify=\"center\"\n            align=\"center\"\n            class=\"mt-3\"\n          >\n            <v-col\n              v-show=\"showScanner\"\n              cols=\"3\"\n            >\n              <v-alert\n                color=\"info\"\n                text\n                style=\"margin-bottom: -10px\"\n              >\n                <div class=\"d-flex align-start\">\n                  <v-icon color=\"info\">\n                    {{ icons.mdiCardOff }}\n                  </v-icon>\n                  <div class=\"ms-3\">\n                    <p class=\"text-base font-weight-medium mb-1\">\n                      QR Code Scanner\n                    </p>\n                  </div>\n                </div>\n              </v-alert>\n              <qrcode-stream\n                v-if=\"showScanner\"\n                :track=\"scannerOptions\"\n                @decode=\"onDecode\"\n                @init=\"onInit\"\n              ></qrcode-stream>\n            </v-col>\n            <div class=\"d-flex align-center mb-2\">\n              <v-btn @click=\"showScanner = !showScanner\">\n                {{ showScanner ? 'Hide' : 'Show' }} Scanner\n              </v-btn>\n            </div>\n          </v-row>\n\n          <v-col\n            v-if=\"formData.customer_id\"\n            cols=\"12\"\n          >\n            <sales-dr-table\n              :customer-id=\"formData.customer_id\"\n              :data=\"salesDrList\"\n              :status=\"formData.status\"\n              @removeDr=\"removeDr\"\n              @showModal=\"toggleDrModal\"\n              @totalPayment=\"totalPaymentCheck\"\n            >\n            </sales-dr-table>\n          </v-col>\n        </v-row>\n        <v-row class=\"mt-10\">\n          <v-col\n            cols=\"12\"\n          >\n            <v-alert\n              color=\"success\"\n              text\n              style=\"margin-bottom: -10px\"\n            >\n              <div class=\"d-flex align-start\">\n                <v-icon color=\"success\">\n                  {{ icons.mdiCurrencySign }}\n                </v-icon>\n                <div class=\"ms-3\">\n                  <p class=\"text-base font-weight-medium mb-1\">\n                    Payments\n                  </p>\n                </div>\n              </div>\n            </v-alert>\n          </v-col>\n          <v-col\n            v-if=\"paymentWarning\"\n            cols=\"12\"\n          >\n            <v-alert\n              color=\"error\"\n              text\n              style=\"margin-bottom: -10px\"\n            >\n              <div class=\"d-flex align-start\">\n                <v-icon color=\"error\">\n                  {{ icons.mdiInformation }}\n                </v-icon>\n                <div class=\"ms-3\">\n                  <p class=\"text-base font-weight-medium mb-1\">\n                    There is still remaining amount payment needed.\n                  </p>\n                </div>\n              </div>\n            </v-alert>\n          </v-col>\n          <v-col\n            v-if=\"formData.customer_id\"\n            cols=\"12\"\n          >\n            <collection-payment\n              :total-amount=\"totalAmount\"\n              :payments=\"payments\"\n              @toggleModal=\"togglePaymentModal\"\n              @removePayment=\"removePayment\"\n            ></collection-payment>\n          </v-col>\n        </v-row>\n        <v-row>\n          <v-col\n            cols=\"auto\"\n            class=\"d-flex\"\n          >\n            <v-btn\n              v-if=\"formData.status !== 'Posted'\"\n              color=\"primary\"\n              class=\"me-3 mt-4\"\n              @click=\"submit\"\n            >\n              <v-icon>\n                {{ icons.mdiContentSave }}\n              </v-icon>\n              {{ mode == 'Create' ? 'Create' : 'Update' }}\n            </v-btn>\n            <v-btn\n              v-if=\"formData.status === 'For Review'\"\n              color=\"success\"\n              class=\"me-3 mt-4\"\n              @click=\"postOrder\"\n            >\n              <v-icon>\n                {{ icons.mdiFinance }}\n              </v-icon>\n              Post\n            </v-btn>\n            <v-btn\n              v-if=\"formData.status === 'Posted'\"\n              color=\"error\"\n              class=\"me-3 mt-4\"\n              @click=\"unpostOrder\"\n            >\n              <v-icon>\n                {{ icons.mdiFinance }}\n              </v-icon>\n              Unpost\n            </v-btn>\n            <v-btn\n              outlined\n              class=\"me-3 mt-4\"\n              type=\"reset\"\n              color=\"info\"\n              @click.prevent=\"cancel\"\n            >\n              <v-icon>\n                {{ icons.mdiProgressClose }}\n              </v-icon>\n              Close\n            </v-btn>\n          </v-col>\n        </v-row>\n      </v-form>\n      <v-dialog\n        v-model=\"drListModal\"\n        hide-overlay\n        fullscreen\n        transition=\"dialog-bottom-transition\"\n      >\n        <dr-list-selection\n          :customer-id=\"formData.customer_id\"\n          :existing-selected-dr=\"salesDrList\"\n          @selectedDrs=\"selectedDrs\"\n          @cancel=\"drListModal = false\"\n        >\n        </dr-list-selection>\n      </v-dialog>\n      <v-dialog\n        v-model=\"customerModal\"\n        fullscreen\n        hide-overlay\n        width=\"1100px\"\n        height=\"500px\"\n        transition=\"dialog-bottom-transition\"\n      >\n        <customer-form\n          :mode=\"'Selecting'\"\n          @submit=\"onSelectCustomer\"\n          @clicked=\"cancel\"\n        ></customer-form>\n      </v-dialog>\n      <v-dialog\n        v-model=\"paymentModal\"\n        hide-overlay\n        width=\"1100px\"\n        height=\"700px\"\n        transition=\"dialog-bottom-transition\"\n      >\n        <payment-form\n          :total-amount=\"totalPaymentAmount\"\n          @submit=\"onSelectCustomer\"\n          @clicked=\"cancel\"\n          @toggleModal=\"togglePaymentModal\"\n          @addedPayment=\"addedPayment\"\n        ></payment-form>\n      </v-dialog>\n    </v-card-text>\n  </v-card>\n</template>\n\n<script>\nimport {\n  computed, onUnmounted, ref, toRef, watch,\n} from '@vue/composition-api'\nimport {\n  mdiAccountPlusOutline, mdiCardOff, mdiCurrencySign,\n  mdiInformation,\n} from '@mdi/js'\nimport CustomerForm from '@/views/pages/master-files/customers/CustomerForm.vue'\nimport store from '@/store'\nimport DrListSelection from '@/views/pages/sales/collections/DrListSelection.vue'\nimport { QrcodeStream } from 'vue-qrcode-reader'\nimport SalesDrTable from './SalesDrTable.vue'\nimport CollectionPayment from './CollectionPayment.vue'\nimport PaymentForm from './PaymentForm.vue'\n\nexport default {\n  name: 'CollectionForm',\n  components: {\n    CustomerForm,\n    SalesDrTable,\n    CollectionPayment,\n    DrListSelection,\n    PaymentForm,\n    QrcodeStream,\n  },\n  props: {\n    mode: {\n      type: String,\n      required: true,\n      default: (() => 'Create'),\n    },\n    data: {\n      type: Object,\n      required: false,\n      default: null,\n    },\n  },\n  setup(props, { emit }) {\n    store.dispatch('TermStore/list')\n    store.dispatch('VatStore/list')\n    store.dispatch('SalesmanStore/list')\n    store.dispatch('DocumentStore/list')\n\n    const modeData = toRef(props, 'mode')\n    const datePosted = ref(new Date().toISOString().substr(0, 10))\n    const dataProp = toRef(props, 'data')\n    const customerModal = ref(false)\n    const drListModal = ref(false)\n    const paymentModal = ref(false)\n    const showScanner = ref(false)\n    const salesDrList = ref([])\n    const formData = ref({\n      dateModal: false,\n      customer_name: null,\n      customer_id: 0,\n      date_posted: null,\n      collection_order_number: null,\n      document_id: null,\n      address: null,\n      remarks: null,\n      area: null,\n      salesman_id_1: null,\n      salesman_id_2: null,\n      term_id: null,\n      vat_id: null,\n    })\n    const paymentWarning = ref(false)\n    const totalAmount = ref(0)\n    const payments = ref([])\n    const paymentsReinitialize = () => {\n      if (formData.value.payments?.length > 0) {\n        payments.value = formData.value.payments.map(payment => {\n          if (payment.payment_type.includes('CashPayment') === true) {\n            // eslint-disable-next-line no-param-reassign\n            payment.payment_type = 'Cash Payment'\n          }\n\n          if (payment.payment_type.includes('CheckPayment') === true) {\n            // eslint-disable-next-line no-param-reassign\n            payment.payment_type = 'Check Payment'\n          }\n\n          if (payment.payment_type.includes('OnlinePayment') === true) {\n            // eslint-disable-next-line no-param-reassign\n            payment.payment_type = 'Online Payment'\n          }\n\n          return payment\n        })\n      }\n    }\n\n    if (modeData.value === 'Edit') {\n      formData.value = dataProp.value\n      formData.value.customer_name = dataProp.value.customer.name\n      formData.value.customer_id = dataProp.value.customer.id\n      formData.value.type = dataProp.value.customer.type\n\n      if (formData.value.sales_dr_payments?.length > 0) {\n        salesDrList.value = []\n        salesDrList.value = formData.value.sales_dr_payments.map(item => {\n          item = item.sales_dr\n\n          if (item.remaining_balance) {\n            item.remaining_balance = parseFloat(item.remaining_balance)\n          }\n\n          return item\n        })\n      }\n\n      paymentsReinitialize()\n\n      store.dispatch('SalesDrStore/drListByCustomer', formData.value.customer.id)\n    } else {\n      formData.value = {\n        dateModal: false,\n        customer_name: null,\n        customer_id: null,\n        date_posted: null,\n        collection_order_number: null,\n        document_id: null,\n        address: null,\n        remarks: null,\n        area: null,\n        salesman_id_1: null,\n        salesman_id_2: null,\n        term_id: null,\n        vat_id: null,\n      }\n    }\n\n    if (formData.value.sales_dr_payments?.length > 0) {\n      salesDrList.value = []\n\n      salesDrList.value = formData.value.sales_dr_payments.map(item => {\n        item.id = item.sales_dr.id\n        item.sales_dr_number = item.sales_dr.sales_dr_number\n        item.remaining_balance = parseFloat(item.sales_dr.remaining_balance)\n\n        return item\n      })\n    }\n\n    onUnmounted(async () => {\n      paymentWarning.value = false\n\n      salesDrList.value = []\n      formData.value = {\n        dateModal: false,\n        customer_name: null,\n        customer_id: null,\n        date_posted: null,\n        collection_order_number: null,\n        document_id: null,\n        address: null,\n        remarks: null,\n        area: null,\n        salesman_id_1: null,\n        salesman_id_2: null,\n        term_id: null,\n        vat_id: null,\n      }\n    })\n\n    watch(dataProp, () => {\n      if (modeData.value === 'Edit') {\n        formData.value = dataProp.value\n        formData.value.customer_name = dataProp.value.customer.name\n        formData.value.customer_id = dataProp.value.customer.id\n        formData.value.type = dataProp.value.customer.type\n        if (formData.value.sales_dr_payments?.length > 0) {\n          salesDrList.value = []\n          salesDrList.value = formData.value.sales_dr_payments.map(item => {\n            item.sales_dr_number = item.sales_dr.sales_dr_number\n            item.remaining_balance = parseFloat(item.sales_dr.remaining_balance)\n\n            return item\n          })\n        }\n\n        paymentsReinitialize()\n\n        store.dispatch('SalesDrStore/drListByCustomer', formData.value.customer.id)\n      } else {\n        formData.value = {\n          dateModal: false,\n          customer_name: null,\n          customer_id: null,\n          date_posted: null,\n          collection_order_number: null,\n          document_id: null,\n          address: null,\n          remarks: null,\n          area: null,\n          salesman_id_1: null,\n          salesman_id_2: null,\n          term_id: null,\n          vat_id: null,\n        }\n\n        salesDrList.value = []\n      }\n    })\n\n    const cancel = () => {\n      emit('submit')\n    }\n\n    const totalPaymentAmount = ref(0)\n\n    const showCustomerModal = () => {\n      customerModal.value = true\n    }\n\n    const onSelectCustomer = customer => {\n      if (customer?.id) {\n        formData.value.customer_name = customer.name\n        formData.value.customer_id = customer.id\n        formData.value.document_id = customer.document_id\n        formData.value.address = customer.address\n        formData.value.remarks = customer.remarks\n        formData.value.area = customer.area\n        formData.value.salesman_id_1 = customer.salesman_id_1\n        formData.value.salesman_id_2 = customer.salesman_id_2\n        formData.value.term_id = customer.term_id\n        formData.value.vat_id = customer.vat_id\n        formData.value.type = customer.type\n        store.dispatch('SalesDrStore/drListByCustomer', customer.id)\n      }\n\n      customerModal.value = false\n    }\n\n    const toggleDrModal = () => {\n      drListModal.value = !drListModal.value\n    }\n\n    const togglePaymentModal = () => {\n      paymentModal.value = !paymentModal.value\n    }\n\n    const selectedDrs = salesDrs => {\n      salesDrList.value = []\n\n      salesDrs.forEach(element => {\n        element.remaining_balance = parseFloat(element.remaining_balance)\n        element.amount_to_pay = 0\n        console.log(element)\n        formData.value.area = element.area ?? formData.value.area\n        formData.value.term_id = element.term_id ?? formData.value.term_id\n        formData.value.address = element.address ?? formData.value.address\n        formData.value.remarks = element.remarks ?? formData.value.remarks\n        formData.value.salesman_id_1 = element.salesman_id_1 ?? formData.value.salesman_id_1\n        formData.value.salesman_id_2 = element.salesman_id_2 ?? formData.value.salesman_id_2\n        formData.value.vat_id = element.vat_id ?? formData.value.vat_id\n        formData.value.promo_code = element.promo_code ?? formData.value.promo_code\n\n        salesDrList.value.push(element)\n      })\n\n      toggleDrModal()\n    }\n\n    const removeDr = item => {\n      const index = salesDrList.value.find(dr => dr.id === item.id)\n\n      salesDrList.value.splice(index, 1)\n    }\n\n    const removePayment = (item, index) => {\n      payments.value.splice(index, 1)\n    }\n\n    const submit = () => {\n      payments.value.forEach((payment, index) => {\n        if (payment.payment_type === 'Cash Payment') {\n          payments.value[index].type = 'cash_payment'\n        }\n\n        if (payment.payment_type === 'Check Payment') {\n          payments.value[index].type = 'check_payment'\n        }\n\n        if (payment.payment_type === 'Online Payment') {\n          payments.value[index].type = 'online_payment'\n        }\n\n        totalPaymentAmount.value = parseFloat(totalPaymentAmount.value) - parseFloat(payment.amount)\n      })\n\n      if (totalPaymentAmount.value > 0) {\n        paymentWarning.value = true\n\n        return\n      }\n\n      paymentWarning.value = false\n\n      if (modeData.value === 'Create') {\n        const payload = formData.value\n        payload.amount = totalAmount.value\n        payload.date_posted = datePosted.value\n        payload.payment_items = payments.value\n        payload.dr_items = salesDrList.value\n\n        store.dispatch('CollectionStore/create', payload).then(\n          response => {\n            if (response.status === undefined) {\n              emit('submit', response.data)\n            }\n          },\n        )\n      } else {\n        const payload = formData.value\n        payload.amount = totalAmount.value\n        payload.date_posted = datePosted.value\n        payload.payment_items = payments.value\n        payload.dr_items = salesDrList.value\n\n        store.dispatch('CollectionStore/update', payload).then(\n          response => {\n            if (response.status === undefined) {\n              emit('submit', response.data)\n            }\n          },\n        )\n      }\n    }\n\n    watch(payments, value => {\n      totalPaymentAmount.value = totalAmount.value ?? 0\n\n      value.forEach(payment => {\n        totalPaymentAmount.value = parseFloat(totalPaymentAmount.value) - parseFloat(payment.amount)\n      })\n    })\n\n    const postOrder = () => {\n      store.dispatch('CollectionStore/postOrder', formData.value.id).then(\n        response => {\n          if (response.status === undefined) {\n            emit('submit', response.data)\n          }\n        },\n      )\n    }\n\n    const unpostOrder = () => {\n      store.dispatch('CollectionStore/unpostOrder', formData.value.id).then(\n        response => {\n          if (response.status === undefined) {\n            emit('submit', response.data)\n          }\n        },\n      )\n    }\n\n    const addedPayment = payment => {\n      togglePaymentModal()\n      payments.value.push(payment)\n    }\n\n    const totalPaymentCheck = amount => {\n      totalAmount.value = amount\n\n      totalPaymentAmount.value = amount\n    }\n\n    const onInit = promise => {\n      promise\n        .then(console.log)\n        .catch(console.error)\n    }\n\n    const onDecode = id => {\n      store.dispatch('SalesDrStore/get', id)\n      console.log(id)\n    }\n\n    const scannerOptions = (detectedCodes, ctx) => {\n      for (const detectedCode of detectedCodes) {\n        const [firstPoint, ...otherPoints] = detectedCode.cornerPoints\n\n        ctx.strokeStyle = 'red'\n\n        ctx.beginPath()\n        ctx.moveTo(firstPoint.x, firstPoint.y)\n        for (const { x, y } of otherPoints) {\n          ctx.lineTo(x, y)\n        }\n        ctx.lineTo(firstPoint.x, firstPoint.y)\n        ctx.closePath()\n        ctx.stroke()\n      }\n    }\n\n    return {\n      totalPaymentAmount,\n      paymentWarning,\n      totalPaymentCheck,\n      postOrder,\n      unpostOrder,\n      removePayment,\n      addedPayment,\n      totalAmount,\n      togglePaymentModal,\n      payments,\n      paymentModal,\n      removeDr,\n      salesDrList,\n      drListModal,\n      selectedDrs,\n      toggleDrModal,\n      submit,\n      cancel,\n      errors: computed(() => store.state.CollectionStore.errors),\n      formData,\n      icons: {\n        mdiInformation,\n        mdiAccountPlusOutline,\n        mdiCardOff,\n        mdiCurrencySign,\n      },\n      showCustomerModal,\n      datePosted,\n      customerModal,\n      onSelectCustomer,\n      salesmans: computed(() => store.state.SalesmanStore.salesmans),\n      terms: computed(() => store.state.TermStore.terms),\n      vats: computed(() => store.state.VatStore.vats),\n      documents: computed(() => store.state.DocumentStore.documents.filter(documentItem => {\n        if (documentItem.module === 'Collection') {\n          documentItem.title = `${documentItem.document_name}`\n\n          return documentItem\n        }\n      })),\n      types: ref([\n        'Regular',\n        'Distributor',\n      ]),\n      onInit,\n      onDecode,\n      scannerOptions,\n      showScanner,\n    }\n  },\n}\n</script>\n\n<style scoped>\n\n</style>\n"]}]}